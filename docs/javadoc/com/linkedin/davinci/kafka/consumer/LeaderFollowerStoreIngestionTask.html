<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>LeaderFollowerStoreIngestionTask (venice API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.linkedin.davinci.kafka.consumer, class: LeaderFollowerStoreIngestionTask">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">com.linkedin.davinci.kafka.consumer</a></div>
<h1 title="Class LeaderFollowerStoreIngestionTask" class="title">Class LeaderFollowerStoreIngestionTask</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance"><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">com.linkedin.davinci.kafka.consumer.StoreIngestionTask</a>
<div class="inheritance">com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask</div>
</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Closeable.html" title="class or interface in java.io" class="external-link">Closeable</a></code>, <code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/AutoCloseable.html" title="class or interface in java.lang" class="external-link">AutoCloseable</a></code>, <code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a></code></dd>
</dl>
<dl class="notes">
<dt>Direct Known Subclasses:</dt>
<dd><code><a href="ActiveActiveStoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">ActiveActiveStoreIngestionTask</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">LeaderFollowerStoreIngestionTask</span>
<span class="extends-implements">extends <a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></span></div>
<div class="block">This class contains the state transition work between leader and follower; both leader and follower
 will keep track of information like which topic leader is consuming from and the corresponding offset
 as well as the latest successfully consumed or produced offset in the version topic (VT).

 State Transition:
     1. OFFLINE -> STANDBY:
        Generate a SUBSCRIBE message in the consumer action queue; the logic
        here is the same as Online/Offline model; all it needs to do is to
        restore the checkpointed state from OffsetRecord;
     2. STANDBY -> LEADER:
        The partition will be marked as in the transition progress from STANDBY
        to LEADER and completes the action immediately; after processing the rest
        of the consumer actions in the queue, check whether there is any partition
        is in the transition progress, if so:
        (i)   consume the latest messages from version topic;
        (ii)  drain all the messages in drainer queue in order to update the latest
              consumed message replication metadata;
        (iii) check whether there has been at least 5 minutes (configurable) of
              inactivity for this partition (meaning no new messages); if so,
              turn on the LEADER flag for this partition.
     3. LEADER -> STANDBY:
        a. if the leader is consuming from VT, just set "isLeader" field to
           false and resume consumption;
        b. if the leader is consuming from anything other than VT, it needs to
           unsubscribe from the leader topic for this partition first, drain
           all the messages in the drainer queue for this leader topic/partition
           so that it can get the last producer callback for the last message it
           produces to VT; block on getting the result from the callback to
           update the corresponding offset in version topic, so that the new
           follower can subscribe back to VT using the recently updated VT offset.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="inherited-list">
<h2 id="nested-classes-inherited-from-class-com.linkedin.davinci.kafka.consumer.StoreIngestionTask">Nested classes/interfaces inherited from class&nbsp;com.linkedin.davinci.kafka.consumer.<a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></h2>
<code><a href="StoreIngestionTask.DelegateConsumerRecordResult.html" title="enum class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask.DelegateConsumerRecordResult</a></code></div>
</section>
</li>
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>protected final <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link">ExecutorService</a></code></div>
<div class="col-second even-row-color"><code><a href="#aaWCIngestionStorageLookupThreadPool" class="member-name-link">aaWCIngestionStorageLookupThreadPool</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-first odd-row-color"><code>static final <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second odd-row-color"><code><a href="#GLOBAL_RT_DIV_KEY_PREFIX" class="member-name-link">GLOBAL_RT_DIV_KEY_PREFIX</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>protected final <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr>byte[]&gt;</code></div>
<div class="col-second even-row-color"><code><a href="#globalRtDivKeyBytesCache" class="member-name-link">globalRtDivKeyBytesCache</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-first odd-row-color"><code>protected final <a href="../../../venice/serialization/avro/InternalAvroSpecificSerializer.html" title="class in com.linkedin.venice.serialization.avro">InternalAvroSpecificSerializer</a>&lt;<a href="../../../venice/kafka/protocol/state/GlobalRtDivState.html" title="class in com.linkedin.venice.kafka.protocol.state">GlobalRtDivState</a>&gt;</code></div>
<div class="col-second odd-row-color"><code><a href="#globalRtDivStateSerializer" class="member-name-link">globalRtDivStateSerializer</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>protected final boolean</code></div>
<div class="col-second even-row-color"><code><a href="#hasChangeCaptureView" class="member-name-link">hasChangeCaptureView</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-first odd-row-color"><code>protected final boolean</code></div>
<div class="col-second odd-row-color"><code><a href="#hasComplexVenicePartitionerMaterializedView" class="member-name-link">hasComplexVenicePartitionerMaterializedView</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>protected final it.unimi.dsi.fastutil.ints.Int2ObjectMap&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;</code></div>
<div class="col-second even-row-color"><code><a href="#kafkaClusterIdToUrlMap" class="member-name-link">kafkaClusterIdToUrlMap</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-first odd-row-color"><code>protected final <a href="../../../venice/serialization/AvroStoreDeserializerCache.html" title="class in com.linkedin.venice.serialization">AvroStoreDeserializerCache</a>&lt;org.apache.avro.generic.GenericRecord&gt;</code></div>
<div class="col-second odd-row-color"><code><a href="#storeDeserializerCache" class="member-name-link">storeDeserializerCache</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>protected <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;</code></div>
<div class="col-second even-row-color"><code><a href="#veniceWriter" class="member-name-link">veniceWriter</a></code></div>
<div class="col-last even-row-color">
<div class="block">N.B.:
    With L/F+native replication and many Leader partitions getting assigned to a single SN this <a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer"><code>VeniceWriter</code></a>
    may be called from multiple thread simultaneously, during start of batch push.</div>
</div>
<div class="col-first odd-row-color"><code>protected final <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;</code></div>
<div class="col-second odd-row-color"><code><a href="#veniceWriterForRealTime" class="member-name-link">veniceWriterForRealTime</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>protected final <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="../../store/view/VeniceViewWriter.html" title="class in com.linkedin.davinci.store.view">VeniceViewWriter</a>&gt;</code></div>
<div class="col-second even-row-color"><code><a href="#viewWriters" class="member-name-link">viewWriters</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
<div class="inherited-list">
<h3 id="fields-inherited-from-class-com.linkedin.davinci.kafka.consumer.StoreIngestionTask">Fields inherited from class&nbsp;com.linkedin.davinci.kafka.consumer.<a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></h3>
<code><a href="StoreIngestionTask.html#aggKafkaConsumerService">aggKafkaConsumerService</a>, <a href="StoreIngestionTask.html#availableSchemaIds">availableSchemaIds</a>, <a href="StoreIngestionTask.html#batchReportIncPushStatusEnabled">batchReportIncPushStatusEnabled</a>, <a href="StoreIngestionTask.html#bootstrapTimeoutInMs">bootstrapTimeoutInMs</a>, <a href="StoreIngestionTask.html#CHUNK_SCHEMA_ID">CHUNK_SCHEMA_ID</a>, <a href="StoreIngestionTask.html#chunkAssembler">chunkAssembler</a>, <a href="StoreIngestionTask.html#compressionStrategy">compressionStrategy</a>, <a href="StoreIngestionTask.html#compressor">compressor</a>, <a href="StoreIngestionTask.html#compressorFactory">compressorFactory</a>, <a href="StoreIngestionTask.html#consumedBytesSinceLastSync">consumedBytesSinceLastSync</a>, <a href="StoreIngestionTask.html#consumerActionSequenceNumber">consumerActionSequenceNumber</a>, <a href="StoreIngestionTask.html#consumerActionsQueue">consumerActionsQueue</a>, <a href="StoreIngestionTask.html#consumerDiv">consumerDiv</a>, <a href="StoreIngestionTask.html#databaseSyncBytesIntervalForDeferredWriteMode">databaseSyncBytesIntervalForDeferredWriteMode</a>, <a href="StoreIngestionTask.html#databaseSyncBytesIntervalForTransactionalMode">databaseSyncBytesIntervalForTransactionalMode</a>, <a href="StoreIngestionTask.html#dataRecoverySourceVersionNumber">dataRecoverySourceVersionNumber</a>, <a href="StoreIngestionTask.html#defaultReadyToServeChecker">defaultReadyToServeChecker</a>, <a href="StoreIngestionTask.html#deserializedSchemaIds">deserializedSchemaIds</a>, <a href="StoreIngestionTask.html#diskUsage">diskUsage</a>, <a href="StoreIngestionTask.html#divErrorMetricCallback">divErrorMetricCallback</a>, <a href="StoreIngestionTask.html#emitMetrics">emitMetrics</a>, <a href="StoreIngestionTask.html#emptyPollSleepMs">emptyPollSleepMs</a>, <a href="StoreIngestionTask.html#errorPartitionId">errorPartitionId</a>, <a href="StoreIngestionTask.html#gracefulShutdownLatch">gracefulShutdownLatch</a>, <a href="StoreIngestionTask.html#hostLevelIngestionStats">hostLevelIngestionStats</a>, <a href="StoreIngestionTask.html#hostName">hostName</a>, <a href="StoreIngestionTask.html#hybridStoreConfig">hybridStoreConfig</a>, <a href="StoreIngestionTask.html#idleCounter">idleCounter</a>, <a href="StoreIngestionTask.html#ingestionNotificationDispatcher">ingestionNotificationDispatcher</a>, <a href="StoreIngestionTask.html#ingestionTaskName">ingestionTaskName</a>, <a href="StoreIngestionTask.html#isChunked">isChunked</a>, <a href="StoreIngestionTask.html#isCurrentVersion">isCurrentVersion</a>, <a href="StoreIngestionTask.html#isDataRecovery">isDataRecovery</a>, <a href="StoreIngestionTask.html#isDaVinciClient">isDaVinciClient</a>, <a href="StoreIngestionTask.html#isGlobalRtDivEnabled">isGlobalRtDivEnabled</a>, <a href="StoreIngestionTask.html#isIsolatedIngestion">isIsolatedIngestion</a>, <a href="StoreIngestionTask.html#isRmdChunked">isRmdChunked</a>, <a href="StoreIngestionTask.html#isRunning">isRunning</a>, <a href="StoreIngestionTask.html#isSystemStore">isSystemStore</a>, <a href="StoreIngestionTask.html#isWriteComputationEnabled">isWriteComputationEnabled</a>, <a href="StoreIngestionTask.html#kafkaClusterUrlResolver">kafkaClusterUrlResolver</a>, <a href="StoreIngestionTask.html#kafkaProps">kafkaProps</a>, <a href="StoreIngestionTask.html#kafkaVersionTopic">kafkaVersionTopic</a>, <a href="StoreIngestionTask.html#KILL_WAIT_TIME_MS">KILL_WAIT_TIME_MS</a>, <a href="StoreIngestionTask.html#localKafkaClusterId">localKafkaClusterId</a>, <a href="StoreIngestionTask.html#localKafkaServer">localKafkaServer</a>, <a href="StoreIngestionTask.html#localKafkaServerSingletonSet">localKafkaServerSingletonSet</a>, <a href="StoreIngestionTask.html#manifestSerializer">manifestSerializer</a>, <a href="StoreIngestionTask.html#metaStoreWriter">metaStoreWriter</a>, <a href="StoreIngestionTask.html#parallelProcessingThreadPool">parallelProcessingThreadPool</a>, <a href="StoreIngestionTask.html#partitionConsumptionStateMap">partitionConsumptionStateMap</a>, <a href="StoreIngestionTask.html#partitionCount">partitionCount</a>, <a href="StoreIngestionTask.html#partitionToPendingConsumerActionCountMap">partitionToPendingConsumerActionCountMap</a>, <a href="StoreIngestionTask.html#pubSubContext">pubSubContext</a>, <a href="StoreIngestionTask.html#pubSubTopicRepository">pubSubTopicRepository</a>, <a href="StoreIngestionTask.html#readCycleDelayMs">readCycleDelayMs</a>, <a href="StoreIngestionTask.html#readOnlyForBatchOnlyStoreEnabled">readOnlyForBatchOnlyStoreEnabled</a>, <a href="StoreIngestionTask.html#realTimeTopic">realTimeTopic</a>, <a href="StoreIngestionTask.html#recordLevelMetricEnabled">recordLevelMetricEnabled</a>, <a href="StoreIngestionTask.html#recordTransformerStats">recordTransformerStats</a>, <a href="StoreIngestionTask.html#REDUNDANT_LOGGING_FILTER">REDUNDANT_LOGGING_FILTER</a>, <a href="StoreIngestionTask.html#resetErrorReplicaEnabled">resetErrorReplicaEnabled</a>, <a href="StoreIngestionTask.html#SCHEMA_POLLING_DELAY_MS">SCHEMA_POLLING_DELAY_MS</a>, <a href="StoreIngestionTask.html#schemaRepository">schemaRepository</a>, <a href="StoreIngestionTask.html#separateRealTimeTopic">separateRealTimeTopic</a>, <a href="StoreIngestionTask.html#serverConfig">serverConfig</a>, <a href="StoreIngestionTask.html#storageEngine">storageEngine</a>, <a href="StoreIngestionTask.html#storageMetadataService">storageMetadataService</a>, <a href="StoreIngestionTask.html#storageService">storageService</a>, <a href="StoreIngestionTask.html#STORE_VERSION_POLLING_DELAY_MS">STORE_VERSION_POLLING_DELAY_MS</a>, <a href="StoreIngestionTask.html#storeBufferService">storeBufferService</a>, <a href="StoreIngestionTask.html#storeName">storeName</a>, <a href="StoreIngestionTask.html#storeRepository">storeRepository</a>, <a href="StoreIngestionTask.html#storeVersionName">storeVersionName</a>, <a href="StoreIngestionTask.html#storeVersionPartitionCount">storeVersionPartitionCount</a>, <a href="StoreIngestionTask.html#topicManagerRepository">topicManagerRepository</a>, <a href="StoreIngestionTask.html#versionedDIVStats">versionedDIVStats</a>, <a href="StoreIngestionTask.html#versionedIngestionStats">versionedIngestionStats</a>, <a href="StoreIngestionTask.html#versionNumber">versionNumber</a>, <a href="StoreIngestionTask.html#versionRole">versionRole</a>, <a href="StoreIngestionTask.html#versionTopic">versionTopic</a>, <a href="StoreIngestionTask.html#WAITING_TIME_FOR_LAST_RECORD_TO_BE_PROCESSED">WAITING_TIME_FOR_LAST_RECORD_TO_BE_PROCESSED</a>, <a href="StoreIngestionTask.html#workloadType">workloadType</a>, <a href="StoreIngestionTask.html#writeComputeFailureCode">writeComputeFailureCode</a>, <a href="StoreIngestionTask.html#zkHelixAdmin">zkHelixAdmin</a></code></div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(com.linkedin.davinci.storage.StorageService,com.linkedin.davinci.kafka.consumer.StoreIngestionTaskFactory.Builder,com.linkedin.venice.meta.Store,com.linkedin.venice.meta.Version,java.util.Properties,java.util.function.BooleanSupplier,com.linkedin.davinci.config.VeniceStoreVersionConfig,int,boolean,java.util.Optional,com.linkedin.davinci.client.InternalDaVinciRecordTransformerConfig,com.linkedin.venice.utils.lazy.Lazy)" class="member-name-link">LeaderFollowerStoreIngestionTask</a><wbr>(<a href="../../storage/StorageService.html" title="class in com.linkedin.davinci.storage">StorageService</a>&nbsp;storageService,
 <a href="StoreIngestionTaskFactory.Builder.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTaskFactory.Builder</a>&nbsp;builder,
 <a href="../../../venice/meta/Store.html" title="interface in com.linkedin.venice.meta">Store</a>&nbsp;store,
 <a href="../../../venice/meta/Version.html" title="interface in com.linkedin.venice.meta">Version</a>&nbsp;version,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Properties.html" title="class or interface in java.util" class="external-link">Properties</a>&nbsp;kafkaConsumerProperties,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/BooleanSupplier.html" title="class or interface in java.util.function" class="external-link">BooleanSupplier</a>&nbsp;isCurrentVersion,
 <a href="../../config/VeniceStoreVersionConfig.html" title="class in com.linkedin.davinci.config">VeniceStoreVersionConfig</a>&nbsp;storeConfig,
 int&nbsp;errorPartitionId,
 boolean&nbsp;isIsolatedIngestion,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Optional.html" title="class or interface in java.util" class="external-link">Optional</a>&lt;<a href="../../store/cache/backend/ObjectCacheBackend.html" title="class in com.linkedin.davinci.store.cache.backend">ObjectCacheBackend</a>&gt;&nbsp;cacheBackend,
 <a href="../../client/InternalDaVinciRecordTransformerConfig.html" title="class in com.linkedin.davinci.client">InternalDaVinciRecordTransformerConfig</a>&nbsp;internalRecordTransformerConfig,
 <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;org.apache.helix.manager.zk.ZKHelixAdmin&gt;&nbsp;zkHelixAdmin)</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#addPartitionConsumptionState(java.lang.Integer,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">addPartitionConsumptionState</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&nbsp;partition,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected final double</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#calculateAssembledRecordSizeRatio(long)" class="member-name-link">calculateAssembledRecordSizeRatio</a><wbr>(long&nbsp;recordSize)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#calculateRtConsumptionStartPositions(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.PubSubTopic,java.util.List)" class="member-name-link">calculateRtConsumptionStartPositions</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/PubSubTopic.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopic</a>&nbsp;newSourceTopic,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/CharSequence.html" title="class or interface in java.lang" class="external-link">CharSequence</a>&gt;&nbsp;unreachableBrokerList)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>protected static void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#checkAndHandleUpstreamOffsetRewind(com.linkedin.venice.pubsub.manager.TopicManager,com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.venice.pubsub.api.PubSubPosition,com.linkedin.venice.pubsub.api.PubSubPosition,com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask)" class="member-name-link">checkAndHandleUpstreamOffsetRewind</a><wbr>(<a href="../../../venice/pubsub/manager/TopicManager.html" title="class in com.linkedin.venice.pubsub.manager">TopicManager</a>&nbsp;topicManager,
 <a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;pubSubTopicPartition,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;newUpstreamPosition,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;previousUpstreamPosition,
 <a href="LeaderFollowerStoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderFollowerStoreIngestionTask</a>&nbsp;ingestionTask)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#checkAndLogIfLagIsAcceptableForHybridStore(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,long,long,boolean,com.linkedin.davinci.ingestion.LagType)" class="member-name-link">checkAndLogIfLagIsAcceptableForHybridStore</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 long&nbsp;lag,
 long&nbsp;threshold,
 boolean&nbsp;shouldLogLag,
 <a href="../../ingestion/LagType.html" title="enum class in com.linkedin.davinci.ingestion">LagType</a>&nbsp;lagType)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Checks whether the lag is acceptable for hybrid stores</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#checkLongRunningTaskState()" class="member-name-link">checkLongRunningTaskState</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">The following function will be executed after processing all the quick actions in the consumer action queues,
 so that the long running actions doesn't block other partition's consumer actions.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>protected static boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#checkWhetherToCloseUnusedVeniceWriter(com.linkedin.venice.utils.lazy.Lazy,com.linkedin.venice.utils.lazy.Lazy,java.util.Map,java.lang.Runnable,java.lang.String)" class="member-name-link">checkWhetherToCloseUnusedVeniceWriter</a><wbr>(<a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;&nbsp;veniceWriterLazy,
 <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;&nbsp;veniceWriterForRealTimeLazy,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&gt;&nbsp;partitionConsumptionStateMap,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a>&nbsp;reInitializeVeniceWriterLazyRunnable,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;versionTopicName)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#closeVeniceViewWriters(boolean)" class="member-name-link">closeVeniceViewWriters</a><wbr>(boolean&nbsp;doFlush)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#closeVeniceWriters(boolean)" class="member-name-link">closeVeniceWriters</a><wbr>(boolean&nbsp;doFlush)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#constructVeniceWriter(com.linkedin.venice.writer.VeniceWriterFactory,java.lang.String,com.linkedin.venice.meta.Version,boolean,int)" class="member-name-link">constructVeniceWriter</a><wbr>(<a href="../../../venice/writer/VeniceWriterFactory.html" title="class in com.linkedin.venice.writer">VeniceWriterFactory</a>&nbsp;veniceWriterFactory,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;topic,
 <a href="../../../venice/meta/Version.html" title="interface in com.linkedin.venice.meta">Version</a>&nbsp;version,
 boolean&nbsp;producerCompressionEnabled,
 int&nbsp;producerCnt)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#consumerUnSubscribeAllTopics(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">consumerUnSubscribeAllTopics</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Unsubscribe from all the topics being consumed for the partition in partitionConsumptionState</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="LeaderProducerCallback.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducerCallback</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#createProducerCallback(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,int,java.lang.String,long)" class="member-name-link">createProducerCallback</a><wbr>(<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="LeaderProducedRecordContext.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducedRecordContext</a>&nbsp;leaderProducedRecordContext,
 int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 long&nbsp;beforeProcessingRecordTimestampNs)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="StoreIngestionTask.DelegateConsumerRecordResult.html" title="enum class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask.DelegateConsumerRecordResult</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#delegateConsumerRecord(com.linkedin.davinci.kafka.consumer.PubSubMessageProcessedResultWrapper,int,java.lang.String,int,long,long)" class="member-name-link">delegateConsumerRecord</a><wbr>(<a href="PubSubMessageProcessedResultWrapper.html" title="class in com.linkedin.davinci.kafka.consumer">PubSubMessageProcessedResultWrapper</a>&nbsp;consumerRecordWrapper,
 int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 int&nbsp;kafkaClusterId,
 long&nbsp;beforeProcessingPerRecordTimestampNs,
 long&nbsp;beforeProcessingBatchRecordsTimestampMs)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">The goal of this function is to possibly produce the incoming kafka message consumed from local VT, remote VT, RT or SR topic to
 local VT if needed.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#demoteToStandby(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.helix.LeaderFollowerPartitionStateModel.LeaderSessionIdChecker)" class="member-name-link">demoteToStandby</a><wbr>(<a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;topicPartition,
 <a href="../../helix/LeaderFollowerPartitionStateModel.LeaderSessionIdChecker.html" title="class in com.linkedin.davinci.helix">LeaderFollowerPartitionStateModel.LeaderSessionIdChecker</a>&nbsp;checker)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getAndUpdateLeaderCompletedState(com.linkedin.venice.message.KafkaKey,com.linkedin.venice.kafka.protocol.KafkaMessageEnvelope,com.linkedin.venice.kafka.protocol.ControlMessage,com.linkedin.venice.pubsub.api.PubSubMessageHeaders,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">getAndUpdateLeaderCompletedState</a><wbr>(<a href="../../../venice/message/KafkaKey.html" title="class in com.linkedin.venice.message">KafkaKey</a>&nbsp;kafkaKey,
 <a href="../../../venice/kafka/protocol/KafkaMessageEnvelope.html" title="class in com.linkedin.venice.kafka.protocol">KafkaMessageEnvelope</a>&nbsp;kafkaValue,
 <a href="../../../venice/kafka/protocol/ControlMessage.html" title="class in com.linkedin.venice.kafka.protocol">ControlMessage</a>&nbsp;controlMessage,
 <a href="../../../venice/pubsub/api/PubSubMessageHeaders.html" title="class in com.linkedin.venice.pubsub.api">PubSubMessageHeaders</a>&nbsp;pubSubMessageHeaders,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">HeartBeat SOS messages carry the leader completion state in the header.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getConsumptionSourceKafkaAddress(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">getConsumptionSourceKafkaAddress</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getDataRecoverySourcePubSub(com.linkedin.venice.meta.Version)" class="member-name-link">getDataRecoverySourcePubSub</a><wbr>(<a href="../../../venice/meta/Version.html" title="interface in com.linkedin.venice.meta">Version</a>&nbsp;version)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>byte[]</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getGlobalRtDivKeyBytes(java.lang.String)" class="member-name-link">getGlobalRtDivKeyBytes</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;brokerUrl)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#getGlobalRtDivKeyName(java.lang.String)" class="member-name-link">getGlobalRtDivKeyName</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;brokerUrl)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">The Global RT DIV is produced on a per-broker basis, so the name includes the broker URL for differentiation.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="IngestionBatchProcessor.html" title="class in com.linkedin.davinci.kafka.consumer">IngestionBatchProcessor</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getIngestionBatchProcessor()" class="member-name-link">getIngestionBatchProcessor</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getLatestConsumedUpstreamPositionForHybridOffsetLagMeasurement(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String)" class="member-name-link">getLatestConsumedUpstreamPositionForHybridOffsetLagMeasurement</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;ignoredKafkaUrl)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">For regular L/F stores without A/A enabled, there is always only one real-time source.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getLatestPersistedRtPositionForLagMeasurement(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String)" class="member-name-link">getLatestPersistedRtPositionForLagMeasurement</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;ignoredUpstreamKafkaUrl)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">For L/F or NR, there is only one entry in upstreamOffsetMap whose key is NON_AA_REPLICATION_UPSTREAM_OFFSET_MAP_KEY.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected int</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getMaxNearlineRecordSizeBytes()" class="member-name-link">getMaxNearlineRecordSizeBytes</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected int</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getMaxRecordSizeBytes()" class="member-name-link">getMaxRecordSizeBytes</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getRealTimeDataSourceKafkaAddress(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">getRealTimeDataSourceKafkaAddress</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getRewindStartPositionForRealTimeTopic(java.lang.CharSequence,com.linkedin.venice.pubsub.api.PubSubTopicPartition,long)" class="member-name-link">getRewindStartPositionForRealTimeTopic</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/CharSequence.html" title="class or interface in java.lang" class="external-link">CharSequence</a>&nbsp;pubSubAddress,
 <a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;rtTopicPartition,
 long&nbsp;rewindStartTimestamp)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns the rewind start position in the real-time topic based on the given timestamp.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getVeniceWriter(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">getVeniceWriter</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>int</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getWriteComputeErrorCode()" class="member-name-link">getWriteComputeErrorCode</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#hasViewWriters()" class="member-name-link">hasViewWriters</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#isHybridFollower(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">isHybridFollower</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>protected static boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isLeader(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">isLeader</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#isRealTimeBufferReplayStarted(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">isRealTimeBufferReplayStarted</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#leaderExecuteTopicSwitch(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.kafka.protocol.TopicSwitch,com.linkedin.venice.pubsub.api.PubSubTopic)" class="member-name-link">leaderExecuteTopicSwitch</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/kafka/protocol/TopicSwitch.html" title="class in com.linkedin.venice.kafka.protocol">TopicSwitch</a>&nbsp;topicSwitch,
 <a href="../../../venice/pubsub/api/PubSubTopic.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopic</a>&nbsp;newSourceTopic)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/ByteBuffer.html" title="class or interface in java.nio" class="external-link">ByteBuffer</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#maybeCompressData(int,java.nio.ByteBuffer,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">maybeCompressData</a><wbr>(int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/ByteBuffer.html" title="class or interface in java.nio" class="external-link">ByteBuffer</a>&nbsp;data,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Compresses data in a bytebuffer when consuming from rt as a leader node and compression is enabled for the store
 version for which we're consuming data.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#maybeSendIngestionHeartbeat()" class="member-name-link">maybeSendIngestionHeartbeat</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">For hybrid stores only, the leader periodically writes a special SOS message to the RT topic with the following properties: <br>
 1.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#measureHybridHeartbeatLag(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)" class="member-name-link">measureHybridHeartbeatLag</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 boolean&nbsp;shouldLogLag)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Measure the hybrid heartbeat lag for replica being tracked in `partitionConsumptionState`.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#measureHybridHeartbeatTimestamp(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)" class="member-name-link">measureHybridHeartbeatTimestamp</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 boolean&nbsp;shouldLogLag)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Measure the hybrid heartbeat timestamp for replica being tracked in `partitionConsumptionState`.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#measureHybridOffsetLag(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)" class="member-name-link">measureHybridOffsetLag</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 boolean&nbsp;shouldLogLag)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">For Leader/Follower state model, we already keep track of the consumption progress in leader, so directly calculate
 the lag with the real-time topic and the leader consumption offset.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected long</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#measureRtLagForMultiRegions(java.util.Set,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)" class="member-name-link">measureRtLagForMultiRegions</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;sourceRealTimeTopicKafkaURLs,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 boolean&nbsp;shouldLogLag)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#measureRtLagForSingleRegion(java.lang.String,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)" class="member-name-link">measureRtLagForSingleRegion</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;rtPubSubBrokerAddress,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 boolean&nbsp;shouldLog)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">This method fetches/calculates latest leader persisted position and last position in RT topic.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#processConsumerAction(com.linkedin.davinci.kafka.consumer.ConsumerAction,com.linkedin.venice.meta.Store)" class="member-name-link">processConsumerAction</a><wbr>(<a href="ConsumerAction.html" title="class in com.linkedin.davinci.kafka.consumer">ConsumerAction</a>&nbsp;message,
 <a href="../../../venice/meta/Store.html" title="interface in com.linkedin.venice.meta">Store</a>&nbsp;store)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#processControlMessageForViews(com.linkedin.venice.message.KafkaKey,com.linkedin.venice.kafka.protocol.KafkaMessageEnvelope,com.linkedin.venice.kafka.protocol.ControlMessage,int,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">processControlMessageForViews</a><wbr>(<a href="../../../venice/message/KafkaKey.html" title="class in com.linkedin.venice.message">KafkaKey</a>&nbsp;kafkaKey,
 <a href="../../../venice/kafka/protocol/KafkaMessageEnvelope.html" title="class in com.linkedin.venice.kafka.protocol">KafkaMessageEnvelope</a>&nbsp;kafkaMessageEnvelope,
 <a href="../../../venice/kafka/protocol/ControlMessage.html" title="class in com.linkedin.venice.kafka.protocol">ControlMessage</a>&nbsp;controlMessage,
 int&nbsp;partition,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">This isn't used for ingestion outside L/F, so we NoOp here and rely on the actual implementation in
  <a href="LeaderFollowerStoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer"><code>LeaderFollowerStoreIngestionTask</code></a></div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#processMessageAndMaybeProduceToKafka(com.linkedin.davinci.kafka.consumer.PubSubMessageProcessedResultWrapper,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,int,java.lang.String,int,long,long)" class="member-name-link">processMessageAndMaybeProduceToKafka</a><wbr>(<a href="PubSubMessageProcessedResultWrapper.html" title="class in com.linkedin.davinci.kafka.consumer">PubSubMessageProcessedResultWrapper</a>&nbsp;consumerRecordWrapper,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 int&nbsp;kafkaClusterId,
 long&nbsp;beforeProcessingRecordTimestampNs,
 long&nbsp;beforeProcessingBatchRecordsTimestampMs)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#processTopicSwitch(com.linkedin.venice.kafka.protocol.ControlMessage,int,com.linkedin.venice.pubsub.api.PubSubPosition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">processTopicSwitch</a><wbr>(<a href="../../../venice/kafka/protocol/ControlMessage.html" title="class in com.linkedin.venice.kafka.protocol">ControlMessage</a>&nbsp;controlMessage,
 int&nbsp;partition,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;offset,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Process <a href="../../../venice/kafka/protocol/TopicSwitch.html" title="class in com.linkedin.venice.kafka.protocol"><code>TopicSwitch</code></a> control message at given partition offset for a specific <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer"><code>PartitionConsumptionState</code></a>.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#produceToLocalKafka(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,java.util.function.BiConsumer,int,java.lang.String,int,long)" class="member-name-link">produceToLocalKafka</a><wbr>(<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="LeaderProducedRecordContext.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducedRecordContext</a>&nbsp;leaderProducedRecordContext,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/BiConsumer.html" title="class or interface in java.util.function" class="external-link">BiConsumer</a>&lt;<a href="../../../venice/writer/ChunkAwareCallback.html" title="interface in com.linkedin.venice.writer">ChunkAwareCallback</a>,<wbr><a href="../../../venice/writer/LeaderMetadataWrapper.html" title="class in com.linkedin.venice.writer">LeaderMetadataWrapper</a>&gt;&nbsp;produceFunction,
 int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 int&nbsp;kafkaClusterId,
 long&nbsp;beforeProcessingRecordTimestampNs)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#promoteToLeader(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.helix.LeaderFollowerPartitionStateModel.LeaderSessionIdChecker)" class="member-name-link">promoteToLeader</a><wbr>(<a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;topicPartition,
 <a href="../../helix/LeaderFollowerPartitionStateModel.LeaderSessionIdChecker.html" title="class in com.linkedin.davinci.helix">LeaderFollowerPartitionStateModel.LeaderSessionIdChecker</a>&nbsp;checker)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#queueUpVersionTopicWritesWithViewWriters(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.util.function.BiFunction,java.util.Map,java.lang.Runnable)" class="member-name-link">queueUpVersionTopicWritesWithViewWriters</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/BiFunction.html" title="class or interface in java.util.function" class="external-link">BiFunction</a>&lt;<a href="../../store/view/VeniceViewWriter.html" title="class in com.linkedin.davinci.store.view">VeniceViewWriter</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;,<wbr><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;&gt;&nbsp;viewWriterRecordProcessor,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;&gt;&nbsp;viewPartitionMap,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a>&nbsp;versionTopicWrite)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected final void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#recordAssembledRecordSizeRatio(double,long)" class="member-name-link">recordAssembledRecordSizeRatio</a><wbr>(double&nbsp;ratio,
 long&nbsp;currentTimeMs)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#recordHeartbeatReceived(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,java.lang.String)" class="member-name-link">recordHeartbeatReceived</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#recordProcessedRecordStats(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,int)" class="member-name-link">recordProcessedRecordStats</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 int&nbsp;processedRecordSize)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#recordWriterStats(long,long,long,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">recordWriterStats</a><wbr>(long&nbsp;consumerTimestampMs,
 long&nbsp;producerBrokerLatencyMs,
 long&nbsp;brokerConsumerLatencyMs,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#refreshIngestionContextIfChanged(com.linkedin.venice.meta.Store)" class="member-name-link">refreshIngestionContextIfChanged</a><wbr>(<a href="../../../venice/meta/Store.html" title="interface in com.linkedin.venice.meta">Store</a>&nbsp;store)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#reportIfCatchUpVersionTopicOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">reportIfCatchUpVersionTopicOffset</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Check if the ingestion progress has reached to the end of the version topic.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#resubscribe(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">resubscribe</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Resubscribe operation by passing new version role and partition role to <a href="AggKafkaConsumerService.html" title="class in com.linkedin.davinci.kafka.consumer"><code>AggKafkaConsumerService</code></a>.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#resubscribeAsFollower(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">resubscribeAsFollower</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#resubscribeAsLeader(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">resubscribeAsLeader</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setNativeReplicationSourceVersionTopicKafkaURL(java.lang.String)" class="member-name-link">setNativeReplicationSourceVersionTopicKafkaURL</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;nativeReplicationSourceVersionTopicKafkaURL)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shouldCompressData(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">shouldCompressData</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shouldNewLeaderSwitchToRemoteConsumption(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">shouldNewLeaderSwitchToRemoteConsumption</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shouldPersistRecord(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">shouldPersistRecord</a><wbr>(<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;record,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Additional safeguards in Leader/Follower ingestion:
 1.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shouldProcessRecord(com.linkedin.venice.pubsub.api.DefaultPubSubMessage)" class="member-name-link">shouldProcessRecord</a><wbr>(<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;record)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">For Leader/Follower model, the follower should have the same kind of check as the Online/Offline model;
 for leader, it's possible that it consumers from real-time topic or GF topic.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shouldProduceToVersionTopic(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">shouldProduceToVersionTopic</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">For the corresponding partition being tracked in `partitionConsumptionState`, if it's in LEADER state and it's
 not consuming from version topic, it should produce the new message to version topic; besides, if LEADER is
 consuming remotely, it should also produce to local fabric.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#startConsumingAsLeader(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">startConsumingAsLeader</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#syncConsumedUpstreamRTOffsetMapIfNeeded(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.util.Map)" class="member-name-link">syncConsumedUpstreamRTOffsetMapIfNeeded</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&gt;&nbsp;upstreamStartPositionByPubSubUrl)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#syncTopicSwitchToIngestionMetadataService(com.linkedin.venice.kafka.protocol.TopicSwitch,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">syncTopicSwitchToIngestionMetadataService</a><wbr>(<a href="../../../venice/kafka/protocol/TopicSwitch.html" title="class in com.linkedin.venice.kafka.protocol">TopicSwitch</a>&nbsp;topicSwitch,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#updateLatestConsumedRtPositions(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String,com.linkedin.venice.pubsub.api.PubSubPosition)" class="member-name-link">updateLatestConsumedRtPositions</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;ignoredPubSubBrokerAddress,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;pubSubPosition)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#updateLatestInMemoryProcessedOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,java.lang.String,boolean)" class="member-name-link">updateLatestInMemoryProcessedOffset</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecordWrapper,
 <a href="LeaderProducedRecordContext.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducedRecordContext</a>&nbsp;leaderProducedRecordContext,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 boolean&nbsp;dryRun)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Maintain the latest processed offsets by drainers in memory; in most of the time, these offsets are ahead of the
 checkpoint offsets inside <a href="../../../venice/offsets/OffsetRecord.html" title="class in com.linkedin.venice.offsets"><code>OffsetRecord</code></a>.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#updateLeaderTopicOnFollower(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">updateLeaderTopicOnFollower</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#updateOffsetMetadataInOffsetRecord(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">updateOffsetMetadataInOffsetRecord</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Sync the metadata about offset in <a href="../../../venice/offsets/OffsetRecord.html" title="class in com.linkedin.venice.offsets"><code>OffsetRecord</code></a>.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#updateOffsetsFromConsumerRecord(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.UpdateVersionTopicOffset,com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.UpdateUpstreamTopicOffset,com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.GetLastKnownUpstreamTopicOffset,java.util.function.Supplier,boolean)" class="member-name-link">updateOffsetsFromConsumerRecord</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="LeaderProducedRecordContext.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducedRecordContext</a>&nbsp;leaderProducedRecordContext,
 com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.UpdateVersionTopicOffset&nbsp;updateVersionTopicOffsetFunction,
 com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.UpdateUpstreamTopicOffset&nbsp;updateUpstreamTopicOffsetFunction,
 com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.GetLastKnownUpstreamTopicOffset&nbsp;lastKnownUpstreamTopicOffsetSupplier,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Supplier.html" title="class or interface in java.util.function" class="external-link">Supplier</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;sourceKafkaUrlSupplier,
 boolean&nbsp;dryRun)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">A helper function to the latest in-memory offsets processed by drainers in <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer"><code>PartitionConsumptionState</code></a>,
 after processing the given <a href="../../../venice/pubsub/api/PubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api"><code>PubSubMessage</code></a>.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Iterable.html" title="class or interface in java.lang" class="external-link">Iterable</a>&lt;<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#validateAndFilterOutDuplicateMessagesFromLeaderTopic(java.lang.Iterable,java.lang.String,com.linkedin.venice.pubsub.api.PubSubTopicPartition)" class="member-name-link">validateAndFilterOutDuplicateMessagesFromLeaderTopic</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Iterable.html" title="class or interface in java.lang" class="external-link">Iterable</a>&lt;<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&gt;&nbsp;records,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 <a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;topicPartition)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#waitForAllMessageToBeProcessedFromTopicPartition(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)" class="member-name-link">waitForAllMessageToBeProcessedFromTopicPartition</a><wbr>(<a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;topicPartition,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Besides draining messages in the drainer queue, wait for the last producer future.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#waitForLastLeaderPersistFuture(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String)" class="member-name-link">waitForLastLeaderPersistFuture</a><wbr>(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;errorMsg)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-com.linkedin.davinci.kafka.consumer.StoreIngestionTask">Methods inherited from class&nbsp;com.linkedin.davinci.kafka.consumer.<a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></h3>
<code><a href="StoreIngestionTask.html#checkIngestionProgress(com.linkedin.venice.meta.Store)">checkIngestionProgress</a>, <a href="StoreIngestionTask.html#cloneDrainerDivProducerStates(int,com.linkedin.davinci.validation.DataIntegrityValidator)">cloneDrainerDivProducerStates</a>, <a href="StoreIngestionTask.html#close()">close</a>, <a href="StoreIngestionTask.html#consumerBatchUnsubscribe(java.util.Set)">consumerBatchUnsubscribe</a>, <a href="StoreIngestionTask.html#consumerHasAnySubscription()">consumerHasAnySubscription</a>, <a href="StoreIngestionTask.html#consumerHasSubscription(com.linkedin.venice.pubsub.api.PubSubTopic,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">consumerHasSubscription</a>, <a href="StoreIngestionTask.html#consumerResetOffset(com.linkedin.venice.pubsub.api.PubSubTopic,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">consumerResetOffset</a>, <a href="StoreIngestionTask.html#consumerSubscribe(com.linkedin.venice.pubsub.api.PubSubTopic,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.PubSubPosition,java.lang.String)">consumerSubscribe</a>, <a href="StoreIngestionTask.html#createKafkaConsumerProperties(java.util.Properties,java.lang.String,boolean)">createKafkaConsumerProperties</a>, <a href="StoreIngestionTask.html#disableMetricsEmission()">disableMetricsEmission</a>, <a href="StoreIngestionTask.html#dropStoragePartitionGracefully(com.linkedin.venice.pubsub.api.PubSubTopicPartition)">dropStoragePartitionGracefully</a>, <a href="StoreIngestionTask.html#dumpPartitionConsumptionStates(com.linkedin.davinci.listener.response.AdminResponse,com.linkedin.venice.utils.ComplementSet)">dumpPartitionConsumptionStates</a>, <a href="StoreIngestionTask.html#dumpStoreVersionState(com.linkedin.davinci.listener.response.AdminResponse)">dumpStoreVersionState</a>, <a href="StoreIngestionTask.html#enableMetricsEmission()">enableMetricsEmission</a>, <a href="StoreIngestionTask.html#extractUpstreamClusterId(com.linkedin.venice.pubsub.api.DefaultPubSubMessage)">extractUpstreamClusterId</a>, <a href="StoreIngestionTask.html#extractUpstreamPosition(com.linkedin.venice.pubsub.api.DefaultPubSubMessage)">extractUpstreamPosition</a>, <a href="StoreIngestionTask.html#getCompressionStrategy()">getCompressionStrategy</a>, <a href="StoreIngestionTask.html#getCompressor()">getCompressor</a>, <a href="StoreIngestionTask.html#getDataIntegrityValidator()">getDataIntegrityValidator</a>, <a href="StoreIngestionTask.html#getFailedIngestionPartitionCount()">getFailedIngestionPartitionCount</a>, <a href="StoreIngestionTask.html#getHostLevelIngestionStats()">getHostLevelIngestionStats</a>, <a href="StoreIngestionTask.html#getIngestionTaskName()">getIngestionTaskName</a>, <a href="StoreIngestionTask.html#getKafkaVersionTopic()">getKafkaVersionTopic</a>, <a href="StoreIngestionTask.html#getOffsetToOnlineLagThresholdPerPartition(java.util.Optional,java.lang.String,int)">getOffsetToOnlineLagThresholdPerPartition</a>, <a href="StoreIngestionTask.html#getPartitionConsumptionState(int)">getPartitionConsumptionState</a>, <a href="StoreIngestionTask.html#getSchemaRepo()">getSchemaRepo</a>, <a href="StoreIngestionTask.html#getServerConfig()">getServerConfig</a>, <a href="StoreIngestionTask.html#getStorageEngine()">getStorageEngine</a>, <a href="StoreIngestionTask.html#getStoragePartitionConfig(boolean,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">getStoragePartitionConfig</a>, <a href="StoreIngestionTask.html#getStoragePartitionConfig(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">getStoragePartitionConfig</a>, <a href="StoreIngestionTask.html#getStorageUtilizationManager()">getStorageUtilizationManager</a>, <a href="StoreIngestionTask.html#getStoreName()">getStoreName</a>, <a href="StoreIngestionTask.html#getTopicManager(java.lang.String)">getTopicManager</a>, <a href="StoreIngestionTask.html#getTopicPartitionEndPosition(java.lang.String,com.linkedin.venice.pubsub.api.PubSubTopicPartition)">getTopicPartitionEndPosition</a>, <a href="StoreIngestionTask.html#getVersionedDIVStats()">getVersionedDIVStats</a>, <a href="StoreIngestionTask.html#getVersionIngestionStats()">getVersionIngestionStats</a>, <a href="StoreIngestionTask.html#getVersionNumber()">getVersionNumber</a>, <a href="StoreIngestionTask.html#getVersionTopic()">getVersionTopic</a>, <a href="StoreIngestionTask.html#hasAllPartitionReportedCompleted()">hasAllPartitionReportedCompleted</a>, <a href="StoreIngestionTask.html#hasAnyPartitionConsumptionState(java.util.function.Predicate)">hasAnyPartitionConsumptionState</a>, <a href="StoreIngestionTask.html#hasAnyPendingSubscription()">hasAnyPendingSubscription</a>, <a href="StoreIngestionTask.html#hasAnySubscription()">hasAnySubscription</a>, <a href="StoreIngestionTask.html#hasPendingPartitionIngestionAction(int)">hasPendingPartitionIngestionAction</a>, <a href="StoreIngestionTask.html#hasReplicas()">hasReplicas</a>, <a href="StoreIngestionTask.html#isActiveActiveReplicationEnabled()">isActiveActiveReplicationEnabled</a>, <a href="StoreIngestionTask.html#isChunked()">isChunked</a>, <a href="StoreIngestionTask.html#isCurrentVersion()">isCurrentVersion</a>, <a href="StoreIngestionTask.html#isHybridMode()">isHybridMode</a>, <a href="StoreIngestionTask.html#isIdleOverThreshold()">isIdleOverThreshold</a>, <a href="StoreIngestionTask.html#isIngestionTaskActive()">isIngestionTaskActive</a>, <a href="StoreIngestionTask.html#isMetricsEmissionEnabled()">isMetricsEmissionEnabled</a>, <a href="StoreIngestionTask.html#isPartitionConsumingOrHasPendingIngestionAction(int)">isPartitionConsumingOrHasPendingIngestionAction</a>, <a href="StoreIngestionTask.html#isProducingVersionTopicHealthy()">isProducingVersionTopicHealthy</a>, <a href="StoreIngestionTask.html#isReadyToServe(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">isReadyToServe</a>, <a href="StoreIngestionTask.html#isRunning()">isRunning</a>, <a href="StoreIngestionTask.html#isSeparatedRealtimeTopicEnabled()">isSeparatedRealtimeTopicEnabled</a>, <a href="StoreIngestionTask.html#isTransientRecordBufferUsed(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">isTransientRecordBufferUsed</a>, <a href="StoreIngestionTask.html#isUserSystemStore()">isUserSystemStore</a>, <a href="StoreIngestionTask.html#kill()">kill</a>, <a href="StoreIngestionTask.html#logStorageOperationWhileUnsubscribed(int)">logStorageOperationWhileUnsubscribed</a>, <a href="StoreIngestionTask.html#measureLagWithCallToPubSub(java.lang.String,com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.venice.pubsub.api.PubSubPosition)">measureLagWithCallToPubSub</a>, <a href="StoreIngestionTask.html#measureLagWithCallToPubSub(java.lang.String,com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.venice.pubsub.api.PubSubPosition,java.util.function.Function)">measureLagWithCallToPubSub</a>, <a href="StoreIngestionTask.html#minZeroLag(long)">minZeroLag</a>, <a href="StoreIngestionTask.html#nextSeqNum()">nextSeqNum</a>, <a href="StoreIngestionTask.html#processCommonConsumerAction(com.linkedin.davinci.kafka.consumer.ConsumerAction)">processCommonConsumerAction</a>, <a href="StoreIngestionTask.html#processConsumerRecord(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,int,java.lang.String,long)">processConsumerRecord</a>, <a href="StoreIngestionTask.html#processEndOfIncrementalPush(com.linkedin.venice.kafka.protocol.ControlMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">processEndOfIncrementalPush</a>, <a href="StoreIngestionTask.html#processEndOfPush(com.linkedin.venice.kafka.protocol.KafkaMessageEnvelope,com.linkedin.venice.pubsub.api.PubSubPosition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">processEndOfPush</a>, <a href="StoreIngestionTask.html#processStartOfIncrementalPush(com.linkedin.venice.kafka.protocol.ControlMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">processStartOfIncrementalPush</a>, <a href="StoreIngestionTask.html#produceToStoreBufferService(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,int,java.lang.String,long,long)">produceToStoreBufferService</a>, <a href="StoreIngestionTask.html#produceToStoreBufferServiceOrKafka(java.lang.Iterable,com.linkedin.venice.pubsub.api.PubSubTopicPartition,java.lang.String,int)">produceToStoreBufferServiceOrKafka</a>, <a href="StoreIngestionTask.html#produceToStoreBufferServiceOrKafkaInBatch(java.lang.Iterable,com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String,int)">produceToStoreBufferServiceOrKafkaInBatch</a>, <a href="StoreIngestionTask.html#putInStorageEngine(int,byte%5B%5D,com.linkedin.venice.kafka.protocol.Put)">putInStorageEngine</a>, <a href="StoreIngestionTask.html#recordAssembledRecordSize(int,java.nio.ByteBuffer,java.nio.ByteBuffer,long)">recordAssembledRecordSize</a>, <a href="StoreIngestionTask.html#recordChecksumVerificationFailure()">recordChecksumVerificationFailure</a>, <a href="StoreIngestionTask.html#removeFromStorageEngine(int,byte%5B%5D,com.linkedin.venice.kafka.protocol.Delete)">removeFromStorageEngine</a>, <a href="StoreIngestionTask.html#reportError(java.lang.String,int,java.lang.Exception)">reportError</a>, <a href="StoreIngestionTask.html#resetPartitionConsumptionOffset(com.linkedin.venice.pubsub.api.PubSubTopicPartition)">resetPartitionConsumptionOffset</a>, <a href="StoreIngestionTask.html#resolveSourceKafkaServersWithinTopicSwitch(com.linkedin.venice.kafka.protocol.TopicSwitch)">resolveSourceKafkaServersWithinTopicSwitch</a>, <a href="StoreIngestionTask.html#run()">run</a>, <a href="StoreIngestionTask.html#setLastConsumerException(java.lang.Exception)">setLastConsumerException</a>, <a href="StoreIngestionTask.html#setLastStoreIngestionException(java.lang.Exception)">setLastStoreIngestionException</a>, <a href="StoreIngestionTask.html#setPartitionConsumptionState(int,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">setPartitionConsumptionState</a>, <a href="StoreIngestionTask.html#shutdownAndWait(int)">shutdownAndWait</a>, <a href="StoreIngestionTask.html#subscribePartition(com.linkedin.venice.pubsub.api.PubSubTopicPartition)">subscribePartition</a>, <a href="StoreIngestionTask.html#subscribePartition(com.linkedin.venice.pubsub.api.PubSubTopicPartition,boolean)">subscribePartition</a>, <a href="StoreIngestionTask.html#throwIfNotRunning()">throwIfNotRunning</a>, <a href="StoreIngestionTask.html#throwOrLogStorageFailureDependingIfStillSubscribed(int,com.linkedin.venice.exceptions.VeniceException)">throwOrLogStorageFailureDependingIfStillSubscribed</a>, <a href="StoreIngestionTask.html#unsubscribeFromTopic(com.linkedin.venice.pubsub.api.PubSubTopic,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">unsubscribeFromTopic</a>, <a href="StoreIngestionTask.html#unSubscribePartition(com.linkedin.venice.pubsub.api.PubSubTopicPartition)">unSubscribePartition</a>, <a href="StoreIngestionTask.html#unSubscribePartition(com.linkedin.venice.pubsub.api.PubSubTopicPartition,boolean)">unSubscribePartition</a>, <a href="StoreIngestionTask.html#updateAndSyncOffsetFromSnapshot(com.linkedin.davinci.validation.PartitionTracker,com.linkedin.venice.pubsub.api.PubSubTopicPartition)">updateAndSyncOffsetFromSnapshot</a>, <a href="StoreIngestionTask.html#updateOffsetMetadataAndSync(java.lang.String,int)">updateOffsetMetadataAndSync</a>, <a href="StoreIngestionTask.html#updateOffsetMetadataAndSyncOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">updateOffsetMetadataAndSyncOffset</a>, <a href="StoreIngestionTask.html#updateOffsetMetadataAndSyncOffset(com.linkedin.davinci.validation.DataIntegrityValidator,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">updateOffsetMetadataAndSyncOffset</a>, <a href="StoreIngestionTask.html#validateMessage(com.linkedin.davinci.validation.PartitionTracker.TopicType,com.linkedin.davinci.validation.DataIntegrityValidator,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">validateMessage</a>, <a href="StoreIngestionTask.html#waitVersionStateAvailable(java.lang.String)">waitVersionStateAvailable</a></code></div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="GLOBAL_RT_DIV_KEY_PREFIX">
<h3>GLOBAL_RT_DIV_KEY_PREFIX</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">GLOBAL_RT_DIV_KEY_PREFIX</span></div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../../../../../constant-values.html#com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.GLOBAL_RT_DIV_KEY_PREFIX">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="veniceWriter">
<h3>veniceWriter</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;</span>&nbsp;<span class="element-name">veniceWriter</span></div>
<div class="block">N.B.:
    With L/F+native replication and many Leader partitions getting assigned to a single SN this <a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer"><code>VeniceWriter</code></a>
    may be called from multiple thread simultaneously, during start of batch push. Therefore, we wrap it in
    <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy"><code>Lazy</code></a> to initialize it in a thread safe way and to ensure that only one instance is created for the
    entire ingestion task.

    Important:
    Please don't use these writers directly, and you should retrieve the writer from <a href="PartitionConsumptionState.html#getVeniceWriterLazyRef()"><code>PartitionConsumptionState.getVeniceWriterLazyRef()</code></a>
    when producing to the local topic.</div>
</section>
</li>
<li>
<section class="detail" id="veniceWriterForRealTime">
<h3>veniceWriterForRealTime</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type"><a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;</span>&nbsp;<span class="element-name">veniceWriterForRealTime</span></div>
</section>
</li>
<li>
<section class="detail" id="kafkaClusterIdToUrlMap">
<h3>kafkaClusterIdToUrlMap</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type">it.unimi.dsi.fastutil.ints.Int2ObjectMap&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;</span>&nbsp;<span class="element-name">kafkaClusterIdToUrlMap</span></div>
</section>
</li>
<li>
<section class="detail" id="globalRtDivKeyBytesCache">
<h3>globalRtDivKeyBytesCache</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr>byte[]&gt;</span>&nbsp;<span class="element-name">globalRtDivKeyBytesCache</span></div>
</section>
</li>
<li>
<section class="detail" id="viewWriters">
<h3>viewWriters</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="../../store/view/VeniceViewWriter.html" title="class in com.linkedin.davinci.store.view">VeniceViewWriter</a>&gt;</span>&nbsp;<span class="element-name">viewWriters</span></div>
</section>
</li>
<li>
<section class="detail" id="hasChangeCaptureView">
<h3>hasChangeCaptureView</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">hasChangeCaptureView</span></div>
</section>
</li>
<li>
<section class="detail" id="hasComplexVenicePartitionerMaterializedView">
<h3>hasComplexVenicePartitionerMaterializedView</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">hasComplexVenicePartitionerMaterializedView</span></div>
</section>
</li>
<li>
<section class="detail" id="globalRtDivStateSerializer">
<h3>globalRtDivStateSerializer</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type"><a href="../../../venice/serialization/avro/InternalAvroSpecificSerializer.html" title="class in com.linkedin.venice.serialization.avro">InternalAvroSpecificSerializer</a>&lt;<a href="../../../venice/kafka/protocol/state/GlobalRtDivState.html" title="class in com.linkedin.venice.kafka.protocol.state">GlobalRtDivState</a>&gt;</span>&nbsp;<span class="element-name">globalRtDivStateSerializer</span></div>
</section>
</li>
<li>
<section class="detail" id="storeDeserializerCache">
<h3>storeDeserializerCache</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type"><a href="../../../venice/serialization/AvroStoreDeserializerCache.html" title="class in com.linkedin.venice.serialization">AvroStoreDeserializerCache</a>&lt;org.apache.avro.generic.GenericRecord&gt;</span>&nbsp;<span class="element-name">storeDeserializerCache</span></div>
</section>
</li>
<li>
<section class="detail" id="aaWCIngestionStorageLookupThreadPool">
<h3>aaWCIngestionStorageLookupThreadPool</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/ExecutorService.html" title="class or interface in java.util.concurrent" class="external-link">ExecutorService</a></span>&nbsp;<span class="element-name">aaWCIngestionStorageLookupThreadPool</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(com.linkedin.davinci.storage.StorageService,com.linkedin.davinci.kafka.consumer.StoreIngestionTaskFactory.Builder,com.linkedin.venice.meta.Store,com.linkedin.venice.meta.Version,java.util.Properties,java.util.function.BooleanSupplier,com.linkedin.davinci.config.VeniceStoreVersionConfig,int,boolean,java.util.Optional,com.linkedin.davinci.client.InternalDaVinciRecordTransformerConfig,com.linkedin.venice.utils.lazy.Lazy)">
<h3>LeaderFollowerStoreIngestionTask</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">LeaderFollowerStoreIngestionTask</span><wbr><span class="parameters">(<a href="../../storage/StorageService.html" title="class in com.linkedin.davinci.storage">StorageService</a>&nbsp;storageService,
 <a href="StoreIngestionTaskFactory.Builder.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTaskFactory.Builder</a>&nbsp;builder,
 <a href="../../../venice/meta/Store.html" title="interface in com.linkedin.venice.meta">Store</a>&nbsp;store,
 <a href="../../../venice/meta/Version.html" title="interface in com.linkedin.venice.meta">Version</a>&nbsp;version,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Properties.html" title="class or interface in java.util" class="external-link">Properties</a>&nbsp;kafkaConsumerProperties,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/BooleanSupplier.html" title="class or interface in java.util.function" class="external-link">BooleanSupplier</a>&nbsp;isCurrentVersion,
 <a href="../../config/VeniceStoreVersionConfig.html" title="class in com.linkedin.davinci.config">VeniceStoreVersionConfig</a>&nbsp;storeConfig,
 int&nbsp;errorPartitionId,
 boolean&nbsp;isIsolatedIngestion,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Optional.html" title="class or interface in java.util" class="external-link">Optional</a>&lt;<a href="../../store/cache/backend/ObjectCacheBackend.html" title="class in com.linkedin.davinci.store.cache.backend">ObjectCacheBackend</a>&gt;&nbsp;cacheBackend,
 <a href="../../client/InternalDaVinciRecordTransformerConfig.html" title="class in com.linkedin.davinci.client">InternalDaVinciRecordTransformerConfig</a>&nbsp;internalRecordTransformerConfig,
 <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;org.apache.helix.manager.zk.ZKHelixAdmin&gt;&nbsp;zkHelixAdmin)</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="constructVeniceWriter(com.linkedin.venice.writer.VeniceWriterFactory,java.lang.String,com.linkedin.venice.meta.Version,boolean,int)">
<h3>constructVeniceWriter</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;</span>&nbsp;<span class="element-name">constructVeniceWriter</span><wbr><span class="parameters">(<a href="../../../venice/writer/VeniceWriterFactory.html" title="class in com.linkedin.venice.writer">VeniceWriterFactory</a>&nbsp;veniceWriterFactory,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;topic,
 <a href="../../../venice/meta/Version.html" title="interface in com.linkedin.venice.meta">Version</a>&nbsp;version,
 boolean&nbsp;producerCompressionEnabled,
 int&nbsp;producerCnt)</span></div>
</section>
</li>
<li>
<section class="detail" id="closeVeniceWriters(boolean)">
<h3>closeVeniceWriters</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">closeVeniceWriters</span><wbr><span class="parameters">(boolean&nbsp;doFlush)</span></div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#closeVeniceWriters(boolean)">closeVeniceWriters</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="closeVeniceViewWriters(boolean)">
<h3>closeVeniceViewWriters</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">closeVeniceViewWriters</span><wbr><span class="parameters">(boolean&nbsp;doFlush)</span></div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#closeVeniceViewWriters(boolean)">closeVeniceViewWriters</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getIngestionBatchProcessor()">
<h3>getIngestionBatchProcessor</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="IngestionBatchProcessor.html" title="class in com.linkedin.davinci.kafka.consumer">IngestionBatchProcessor</a></span>&nbsp;<span class="element-name">getIngestionBatchProcessor</span>()</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#getIngestionBatchProcessor()">getIngestionBatchProcessor</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="promoteToLeader(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.helix.LeaderFollowerPartitionStateModel.LeaderSessionIdChecker)">
<h3>promoteToLeader</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">promoteToLeader</span><wbr><span class="parameters">(<a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;topicPartition,
 <a href="../../helix/LeaderFollowerPartitionStateModel.LeaderSessionIdChecker.html" title="class in com.linkedin.davinci.helix">LeaderFollowerPartitionStateModel.LeaderSessionIdChecker</a>&nbsp;checker)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#promoteToLeader(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.helix.LeaderFollowerPartitionStateModel.LeaderSessionIdChecker)">promoteToLeader</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="demoteToStandby(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.helix.LeaderFollowerPartitionStateModel.LeaderSessionIdChecker)">
<h3>demoteToStandby</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">demoteToStandby</span><wbr><span class="parameters">(<a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;topicPartition,
 <a href="../../helix/LeaderFollowerPartitionStateModel.LeaderSessionIdChecker.html" title="class in com.linkedin.davinci.helix">LeaderFollowerPartitionStateModel.LeaderSessionIdChecker</a>&nbsp;checker)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#demoteToStandby(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.helix.LeaderFollowerPartitionStateModel.LeaderSessionIdChecker)">demoteToStandby</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="processConsumerAction(com.linkedin.davinci.kafka.consumer.ConsumerAction,com.linkedin.venice.meta.Store)">
<h3>processConsumerAction</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">processConsumerAction</span><wbr><span class="parameters">(<a href="ConsumerAction.html" title="class in com.linkedin.davinci.kafka.consumer">ConsumerAction</a>&nbsp;message,
 <a href="../../../venice/meta/Store.html" title="interface in com.linkedin.venice.meta">Store</a>&nbsp;store)</span>
                              throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#processConsumerAction(com.linkedin.davinci.kafka.consumer.ConsumerAction,com.linkedin.venice.meta.Store)">processConsumerAction</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="checkLongRunningTaskState()">
<h3>checkLongRunningTaskState</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">checkLongRunningTaskState</span>()
                                  throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></span></div>
<div class="block">The following function will be executed after processing all the quick actions in the consumer action queues,
 so that the long running actions doesn't block other partition's consumer actions. Besides, there is no thread
 sleeping operations in this function in order to be efficient, but this function will be invoked again and again in
 the main loop of the StoreIngestionTask to check whether some long-running actions can finish now.

 The only drawback is that for regular batch push, leader flag is never on at least a few minutes after the leader
 consumes the last message (END_OF_PUSH), which is an acceptable trade-off for us in order to share and test the
 same code path between regular push job, hybrid store and reprocessing job.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#checkLongRunningTaskState()">checkLongRunningTaskState</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="checkWhetherToCloseUnusedVeniceWriter(com.linkedin.venice.utils.lazy.Lazy,com.linkedin.venice.utils.lazy.Lazy,java.util.Map,java.lang.Runnable,java.lang.String)">
<h3>checkWhetherToCloseUnusedVeniceWriter</h3>
<div class="member-signature"><span class="modifiers">protected static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">checkWhetherToCloseUnusedVeniceWriter</span><wbr><span class="parameters">(<a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;&nbsp;veniceWriterLazy,
 <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;&nbsp;veniceWriterForRealTimeLazy,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&gt;&nbsp;partitionConsumptionStateMap,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a>&nbsp;reInitializeVeniceWriterLazyRunnable,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;versionTopicName)</span></div>
</section>
</li>
<li>
<section class="detail" id="calculateRtConsumptionStartPositions(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.PubSubTopic,java.util.List)">
<h3>calculateRtConsumptionStartPositions</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&gt;</span>&nbsp;<span class="element-name">calculateRtConsumptionStartPositions</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/PubSubTopic.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopic</a>&nbsp;newSourceTopic,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/CharSequence.html" title="class or interface in java.lang" class="external-link">CharSequence</a>&gt;&nbsp;unreachableBrokerList)</span></div>
</section>
</li>
<li>
<section class="detail" id="startConsumingAsLeader(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>startConsumingAsLeader</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">startConsumingAsLeader</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#startConsumingAsLeader(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">startConsumingAsLeader</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="leaderExecuteTopicSwitch(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.kafka.protocol.TopicSwitch,com.linkedin.venice.pubsub.api.PubSubTopic)">
<h3>leaderExecuteTopicSwitch</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">leaderExecuteTopicSwitch</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/kafka/protocol/TopicSwitch.html" title="class in com.linkedin.venice.kafka.protocol">TopicSwitch</a>&nbsp;topicSwitch,
 <a href="../../../venice/pubsub/api/PubSubTopic.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopic</a>&nbsp;newSourceTopic)</span></div>
</section>
</li>
<li>
<section class="detail" id="syncConsumedUpstreamRTOffsetMapIfNeeded(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.util.Map)">
<h3>syncConsumedUpstreamRTOffsetMapIfNeeded</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">syncConsumedUpstreamRTOffsetMapIfNeeded</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&gt;&nbsp;upstreamStartPositionByPubSubUrl)</span></div>
</section>
</li>
<li>
<section class="detail" id="waitForLastLeaderPersistFuture(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String)">
<h3>waitForLastLeaderPersistFuture</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">waitForLastLeaderPersistFuture</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;errorMsg)</span></div>
</section>
</li>
<li>
<section class="detail" id="getRewindStartPositionForRealTimeTopic(java.lang.CharSequence,com.linkedin.venice.pubsub.api.PubSubTopicPartition,long)">
<h3>getRewindStartPositionForRealTimeTopic</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a></span>&nbsp;<span class="element-name">getRewindStartPositionForRealTimeTopic</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/CharSequence.html" title="class or interface in java.lang" class="external-link">CharSequence</a>&nbsp;pubSubAddress,
 <a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;rtTopicPartition,
 long&nbsp;rewindStartTimestamp)</span></div>
<div class="block">Returns the rewind start position in the real-time topic based on the given timestamp.

 <p>This is used during a future version push when the system begins replaying
 real-time data from a configured rewind point (e.g., 24 hours in the past)
 into the new version topic.</p></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>pubSubAddress</code> - the PubSub endpoint or address</dd>
<dd><code>rtTopicPartition</code> - the real-time topic partition</dd>
<dd><code>rewindStartTimestamp</code> - the rewind start time (epoch ms)</dd>
<dt>Returns:</dt>
<dd>the corresponding PubSubPosition to start replaying from</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getConsumptionSourceKafkaAddress(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>getConsumptionSourceKafkaAddress</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;</span>&nbsp;<span class="element-name">getConsumptionSourceKafkaAddress</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#getConsumptionSourceKafkaAddress(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">getConsumptionSourceKafkaAddress</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getRealTimeDataSourceKafkaAddress(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>getRealTimeDataSourceKafkaAddress</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;</span>&nbsp;<span class="element-name">getRealTimeDataSourceKafkaAddress</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#getRealTimeDataSourceKafkaAddress(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">getRealTimeDataSourceKafkaAddress</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="shouldNewLeaderSwitchToRemoteConsumption(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>shouldNewLeaderSwitchToRemoteConsumption</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">shouldNewLeaderSwitchToRemoteConsumption</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
</section>
</li>
<li>
<section class="detail" id="shouldProduceToVersionTopic(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>shouldProduceToVersionTopic</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">shouldProduceToVersionTopic</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<div class="block">For the corresponding partition being tracked in `partitionConsumptionState`, if it's in LEADER state and it's
 not consuming from version topic, it should produce the new message to version topic; besides, if LEADER is
 consuming remotely, it should also produce to local fabric.

 If buffer replay is disable, all replicas will stick to version topic, no one is going to produce any message.</div>
</section>
</li>
<li>
<section class="detail" id="isLeader(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>isLeader</h3>
<div class="member-signature"><span class="modifiers">protected static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">isLeader</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
</section>
</li>
<li>
<section class="detail" id="processTopicSwitch(com.linkedin.venice.kafka.protocol.ControlMessage,int,com.linkedin.venice.pubsub.api.PubSubPosition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>processTopicSwitch</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">processTopicSwitch</span><wbr><span class="parameters">(<a href="../../../venice/kafka/protocol/ControlMessage.html" title="class in com.linkedin.venice.kafka.protocol">ControlMessage</a>&nbsp;controlMessage,
 int&nbsp;partition,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;offset,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<div class="block">Process <a href="../../../venice/kafka/protocol/TopicSwitch.html" title="class in com.linkedin.venice.kafka.protocol"><code>TopicSwitch</code></a> control message at given partition offset for a specific <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer"><code>PartitionConsumptionState</code></a>.</div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#processTopicSwitch(com.linkedin.venice.kafka.protocol.ControlMessage,int,com.linkedin.venice.pubsub.api.PubSubPosition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">processTopicSwitch</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="syncTopicSwitchToIngestionMetadataService(com.linkedin.venice.kafka.protocol.TopicSwitch,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>syncTopicSwitchToIngestionMetadataService</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">syncTopicSwitchToIngestionMetadataService</span><wbr><span class="parameters">(<a href="../../../venice/kafka/protocol/TopicSwitch.html" title="class in com.linkedin.venice.kafka.protocol">TopicSwitch</a>&nbsp;topicSwitch,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
</section>
</li>
<li>
<section class="detail" id="updateOffsetsFromConsumerRecord(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.UpdateVersionTopicOffset,com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.UpdateUpstreamTopicOffset,com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.GetLastKnownUpstreamTopicOffset,java.util.function.Supplier,boolean)">
<h3>updateOffsetsFromConsumerRecord</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">updateOffsetsFromConsumerRecord</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="LeaderProducedRecordContext.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducedRecordContext</a>&nbsp;leaderProducedRecordContext,
 com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.UpdateVersionTopicOffset&nbsp;updateVersionTopicOffsetFunction,
 com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.UpdateUpstreamTopicOffset&nbsp;updateUpstreamTopicOffsetFunction,
 com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask.GetLastKnownUpstreamTopicOffset&nbsp;lastKnownUpstreamTopicOffsetSupplier,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Supplier.html" title="class or interface in java.util.function" class="external-link">Supplier</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;sourceKafkaUrlSupplier,
 boolean&nbsp;dryRun)</span></div>
<div class="block">A helper function to the latest in-memory offsets processed by drainers in <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer"><code>PartitionConsumptionState</code></a>,
 after processing the given <a href="../../../venice/pubsub/api/PubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api"><code>PubSubMessage</code></a>.

 When using this helper function to update the latest in-memory offsets processed by drainers in <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer"><code>PartitionConsumptionState</code></a>:
 "updateVersionTopicOffsetFunction" should try to update the VT offset in <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer"><code>PartitionConsumptionState</code></a>
 "updateRealtimeTopicOffsetFunction" should try to update the latest processed upstream offset map in <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer"><code>PartitionConsumptionState</code></a>

 In LeaderFollowerStoreIngestionTask, "sourceKafkaUrlSupplier" should always return <a href="../../../venice/offsets/OffsetRecord.html#NON_AA_REPLICATION_UPSTREAM_OFFSET_MAP_KEY"><code>OffsetRecord.NON_AA_REPLICATION_UPSTREAM_OFFSET_MAP_KEY</code></a>;
 in ActiveActiveStoreIngestionTask, "sourceKafkaUrlSupplier" should return the actual source Kafka url of the "consumerRecordWrapper"

 Dry-run mode would only check whether the offset rewind is benign or not instead of persisting the processed offset.</div>
</section>
</li>
<li>
<section class="detail" id="updateOffsetMetadataInOffsetRecord(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>updateOffsetMetadataInOffsetRecord</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">updateOffsetMetadataInOffsetRecord</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="StoreIngestionTask.html#updateOffsetMetadataInOffsetRecord(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">StoreIngestionTask</a></code></span></div>
<div class="block">Sync the metadata about offset in <a href="../../../venice/offsets/OffsetRecord.html" title="class in com.linkedin.venice.offsets"><code>OffsetRecord</code></a>.
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer"><code>PartitionConsumptionState</code></a> will pass through some information to <a href="../../../venice/offsets/OffsetRecord.html" title="class in com.linkedin.venice.offsets"><code>OffsetRecord</code></a> for persistence and
 Offset rewind/split brain has been guarded in <a href="StoreIngestionTask.html#updateLatestInMemoryProcessedOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,java.lang.String,boolean)"><code>StoreIngestionTask.updateLatestInMemoryProcessedOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState, com.linkedin.venice.pubsub.api.DefaultPubSubMessage, com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext, java.lang.String, boolean)</code></a>.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#updateOffsetMetadataInOffsetRecord(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">updateOffsetMetadataInOffsetRecord</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="updateLatestInMemoryProcessedOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,java.lang.String,boolean)">
<h3>updateLatestInMemoryProcessedOffset</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">updateLatestInMemoryProcessedOffset</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecordWrapper,
 <a href="LeaderProducedRecordContext.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducedRecordContext</a>&nbsp;leaderProducedRecordContext,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 boolean&nbsp;dryRun)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="StoreIngestionTask.html#updateLatestInMemoryProcessedOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,java.lang.String,boolean)">StoreIngestionTask</a></code></span></div>
<div class="block">Maintain the latest processed offsets by drainers in memory; in most of the time, these offsets are ahead of the
 checkpoint offsets inside <a href="../../../venice/offsets/OffsetRecord.html" title="class in com.linkedin.venice.offsets"><code>OffsetRecord</code></a>. Prior to update the offset in memory, the underlying storage engine
 should have persisted the given record.

 Dry-run mode will only do offset rewind check and it won't update the processed offset.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#updateLatestInMemoryProcessedOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,java.lang.String,boolean)">updateLatestInMemoryProcessedOffset</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="checkAndHandleUpstreamOffsetRewind(com.linkedin.venice.pubsub.manager.TopicManager,com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.venice.pubsub.api.PubSubPosition,com.linkedin.venice.pubsub.api.PubSubPosition,com.linkedin.davinci.kafka.consumer.LeaderFollowerStoreIngestionTask)">
<h3>checkAndHandleUpstreamOffsetRewind</h3>
<div class="member-signature"><span class="modifiers">protected static</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">checkAndHandleUpstreamOffsetRewind</span><wbr><span class="parameters">(<a href="../../../venice/pubsub/manager/TopicManager.html" title="class in com.linkedin.venice.pubsub.manager">TopicManager</a>&nbsp;topicManager,
 <a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;pubSubTopicPartition,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;newUpstreamPosition,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;previousUpstreamPosition,
 <a href="LeaderFollowerStoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderFollowerStoreIngestionTask</a>&nbsp;ingestionTask)</span></div>
</section>
</li>
<li>
<section class="detail" id="produceToLocalKafka(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,java.util.function.BiConsumer,int,java.lang.String,int,long)">
<h3>produceToLocalKafka</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">produceToLocalKafka</span><wbr><span class="parameters">(<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="LeaderProducedRecordContext.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducedRecordContext</a>&nbsp;leaderProducedRecordContext,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/BiConsumer.html" title="class or interface in java.util.function" class="external-link">BiConsumer</a>&lt;<a href="../../../venice/writer/ChunkAwareCallback.html" title="interface in com.linkedin.venice.writer">ChunkAwareCallback</a>,<wbr><a href="../../../venice/writer/LeaderMetadataWrapper.html" title="class in com.linkedin.venice.writer">LeaderMetadataWrapper</a>&gt;&nbsp;produceFunction,
 int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 int&nbsp;kafkaClusterId,
 long&nbsp;beforeProcessingRecordTimestampNs)</span></div>
</section>
</li>
<li>
<section class="detail" id="isRealTimeBufferReplayStarted(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>isRealTimeBufferReplayStarted</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">isRealTimeBufferReplayStarted</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#isRealTimeBufferReplayStarted(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">isRealTimeBufferReplayStarted</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="measureHybridOffsetLag(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">
<h3>measureHybridOffsetLag</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">measureHybridOffsetLag</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 boolean&nbsp;shouldLogLag)</span></div>
<div class="block">For Leader/Follower state model, we already keep track of the consumption progress in leader, so directly calculate
 the lag with the real-time topic and the leader consumption offset.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#measureHybridOffsetLag(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">measureHybridOffsetLag</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="measureHybridHeartbeatLag(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">
<h3>measureHybridHeartbeatLag</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">measureHybridHeartbeatLag</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 boolean&nbsp;shouldLogLag)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="StoreIngestionTask.html#measureHybridHeartbeatLag(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">StoreIngestionTask</a></code></span></div>
<div class="block">Measure the hybrid heartbeat lag for replica being tracked in `partitionConsumptionState`.
 If it is Da Vinci client, return <a href="../../stats/ingestion/heartbeat/HeartbeatMonitoringService.html#INVALID_HEARTBEAT_LAG"><code>HeartbeatMonitoringService.INVALID_HEARTBEAT_LAG</code></a> before it is implemented.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#measureHybridHeartbeatLag(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">measureHybridHeartbeatLag</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="measureHybridHeartbeatTimestamp(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">
<h3>measureHybridHeartbeatTimestamp</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">measureHybridHeartbeatTimestamp</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 boolean&nbsp;shouldLogLag)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="StoreIngestionTask.html#measureHybridHeartbeatTimestamp(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">StoreIngestionTask</a></code></span></div>
<div class="block">Measure the hybrid heartbeat timestamp for replica being tracked in `partitionConsumptionState`.
 If it is Da Vinci client, return <a href="../../stats/ingestion/heartbeat/HeartbeatMonitoringService.html#INVALID_MESSAGE_TIMESTAMP"><code>HeartbeatMonitoringService.INVALID_MESSAGE_TIMESTAMP</code></a> before it is implemented.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#measureHybridHeartbeatTimestamp(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">measureHybridHeartbeatTimestamp</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="measureRtLagForMultiRegions(java.util.Set,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">
<h3>measureRtLagForMultiRegions</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">measureRtLagForMultiRegions</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;sourceRealTimeTopicKafkaURLs,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 boolean&nbsp;shouldLogLag)</span></div>
</section>
</li>
<li>
<section class="detail" id="reportIfCatchUpVersionTopicOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>reportIfCatchUpVersionTopicOffset</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">reportIfCatchUpVersionTopicOffset</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="StoreIngestionTask.html#reportIfCatchUpVersionTopicOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">StoreIngestionTask</a></code></span></div>
<div class="block">Check if the ingestion progress has reached to the end of the version topic. This is currently only
 used <a href="LeaderFollowerStoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer"><code>LeaderFollowerStoreIngestionTask</code></a>.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#reportIfCatchUpVersionTopicOffset(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">reportIfCatchUpVersionTopicOffset</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="shouldProcessRecord(com.linkedin.venice.pubsub.api.DefaultPubSubMessage)">
<h3>shouldProcessRecord</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">shouldProcessRecord</span><wbr><span class="parameters">(<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;record)</span></div>
<div class="block">For Leader/Follower model, the follower should have the same kind of check as the Online/Offline model;
 for leader, it's possible that it consumers from real-time topic or GF topic.</div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#shouldProcessRecord(com.linkedin.venice.pubsub.api.DefaultPubSubMessage)">shouldProcessRecord</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="shouldPersistRecord(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>shouldPersistRecord</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">shouldPersistRecord</span><wbr><span class="parameters">(<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;record,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<div class="block">Additional safeguards in Leader/Follower ingestion:
 1. Check whether the incoming messages are from the expected source topics</div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#shouldPersistRecord(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">shouldPersistRecord</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="recordWriterStats(long,long,long,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>recordWriterStats</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">recordWriterStats</span><wbr><span class="parameters">(long&nbsp;consumerTimestampMs,
 long&nbsp;producerBrokerLatencyMs,
 long&nbsp;brokerConsumerLatencyMs,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#recordWriterStats(long,long,long,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">recordWriterStats</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="recordProcessedRecordStats(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,int)">
<h3>recordProcessedRecordStats</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">recordProcessedRecordStats</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 int&nbsp;processedRecordSize)</span></div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#recordProcessedRecordStats(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,int)">recordProcessedRecordStats</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getMaxRecordSizeBytes()">
<h3>getMaxRecordSizeBytes</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">getMaxRecordSizeBytes</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getMaxNearlineRecordSizeBytes()">
<h3>getMaxNearlineRecordSizeBytes</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">getMaxNearlineRecordSizeBytes</span>()</div>
</section>
</li>
<li>
<section class="detail" id="calculateAssembledRecordSizeRatio(long)">
<h3>calculateAssembledRecordSizeRatio</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type">double</span>&nbsp;<span class="element-name">calculateAssembledRecordSizeRatio</span><wbr><span class="parameters">(long&nbsp;recordSize)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#calculateAssembledRecordSizeRatio(long)">calculateAssembledRecordSizeRatio</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="recordAssembledRecordSizeRatio(double,long)">
<h3>recordAssembledRecordSizeRatio</h3>
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">recordAssembledRecordSizeRatio</span><wbr><span class="parameters">(double&nbsp;ratio,
 long&nbsp;currentTimeMs)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#recordAssembledRecordSizeRatio(double,long)">recordAssembledRecordSizeRatio</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isHybridFollower(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>isHybridFollower</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">isHybridFollower</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#isHybridFollower(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">isHybridFollower</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="checkAndLogIfLagIsAcceptableForHybridStore(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,long,long,boolean,com.linkedin.davinci.ingestion.LagType)">
<h3>checkAndLogIfLagIsAcceptableForHybridStore</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">checkAndLogIfLagIsAcceptableForHybridStore</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 long&nbsp;lag,
 long&nbsp;threshold,
 boolean&nbsp;shouldLogLag,
 <a href="../../ingestion/LagType.html" title="enum class in com.linkedin.davinci.ingestion">LagType</a>&nbsp;lagType)</span></div>
<div class="block">Checks whether the lag is acceptable for hybrid stores
 <p>
 If the instance is a hybrid standby or DaVinciClient: Also check if <br>
 1. checkLeaderCompleteStateInFollower feature is enabled based on configs <br>
 2. leaderCompleteStatus has the leader state=completed and <br>
 3. the last update time was within the configured time interval to not use the stale leader state: check
    <a href="../../../venice/ConfigKeys.html#SERVER_LEADER_COMPLETE_STATE_CHECK_IN_FOLLOWER_VALID_INTERVAL_MS"><code>ConfigKeys.SERVER_LEADER_COMPLETE_STATE_CHECK_IN_FOLLOWER_VALID_INTERVAL_MS</code></a></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#checkAndLogIfLagIsAcceptableForHybridStore(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,long,long,boolean,com.linkedin.davinci.ingestion.LagType)">checkAndLogIfLagIsAcceptableForHybridStore</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getAndUpdateLeaderCompletedState(com.linkedin.venice.message.KafkaKey,com.linkedin.venice.kafka.protocol.KafkaMessageEnvelope,com.linkedin.venice.kafka.protocol.ControlMessage,com.linkedin.venice.pubsub.api.PubSubMessageHeaders,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>getAndUpdateLeaderCompletedState</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">getAndUpdateLeaderCompletedState</span><wbr><span class="parameters">(<a href="../../../venice/message/KafkaKey.html" title="class in com.linkedin.venice.message">KafkaKey</a>&nbsp;kafkaKey,
 <a href="../../../venice/kafka/protocol/KafkaMessageEnvelope.html" title="class in com.linkedin.venice.kafka.protocol">KafkaMessageEnvelope</a>&nbsp;kafkaValue,
 <a href="../../../venice/kafka/protocol/ControlMessage.html" title="class in com.linkedin.venice.kafka.protocol">ControlMessage</a>&nbsp;controlMessage,
 <a href="../../../venice/pubsub/api/PubSubMessageHeaders.html" title="class in com.linkedin.venice.pubsub.api">PubSubMessageHeaders</a>&nbsp;pubSubMessageHeaders,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<div class="block">HeartBeat SOS messages carry the leader completion state in the header. This function extracts the leader completion
 state from that header and updates the  accordingly.</div>
</section>
</li>
<li>
<section class="detail" id="recordHeartbeatReceived(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,java.lang.String)">
<h3>recordHeartbeatReceived</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">recordHeartbeatReceived</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl)</span></div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#recordHeartbeatReceived(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.venice.pubsub.api.DefaultPubSubMessage,java.lang.String)">recordHeartbeatReceived</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="validateAndFilterOutDuplicateMessagesFromLeaderTopic(java.lang.Iterable,java.lang.String,com.linkedin.venice.pubsub.api.PubSubTopicPartition)">
<h3>validateAndFilterOutDuplicateMessagesFromLeaderTopic</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Iterable.html" title="class or interface in java.lang" class="external-link">Iterable</a>&lt;<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&gt;</span>&nbsp;<span class="element-name">validateAndFilterOutDuplicateMessagesFromLeaderTopic</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Iterable.html" title="class or interface in java.lang" class="external-link">Iterable</a>&lt;<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&gt;&nbsp;records,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 <a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;topicPartition)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#validateAndFilterOutDuplicateMessagesFromLeaderTopic(java.lang.Iterable,java.lang.String,com.linkedin.venice.pubsub.api.PubSubTopicPartition)">validateAndFilterOutDuplicateMessagesFromLeaderTopic</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="delegateConsumerRecord(com.linkedin.davinci.kafka.consumer.PubSubMessageProcessedResultWrapper,int,java.lang.String,int,long,long)">
<h3>delegateConsumerRecord</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="StoreIngestionTask.DelegateConsumerRecordResult.html" title="enum class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask.DelegateConsumerRecordResult</a></span>&nbsp;<span class="element-name">delegateConsumerRecord</span><wbr><span class="parameters">(<a href="PubSubMessageProcessedResultWrapper.html" title="class in com.linkedin.davinci.kafka.consumer">PubSubMessageProcessedResultWrapper</a>&nbsp;consumerRecordWrapper,
 int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 int&nbsp;kafkaClusterId,
 long&nbsp;beforeProcessingPerRecordTimestampNs,
 long&nbsp;beforeProcessingBatchRecordsTimestampMs)</span></div>
<div class="block">The goal of this function is to possibly produce the incoming kafka message consumed from local VT, remote VT, RT or SR topic to
 local VT if needed. It's decided based on the function output of <a href="#shouldProduceToVersionTopic(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)"><code>shouldProduceToVersionTopic(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)</code></a> and message type.
 It also perform any necessary additional computation operation such as for write-compute/update message.
 It returns a boolean indicating if it was produced to kafka or not.

 This function should be called as one of the first steps in processing pipeline for all messages consumed from any kafka topic.

 The caller of this function should only process this  further if the return is
 <a href="StoreIngestionTask.DelegateConsumerRecordResult.html#QUEUED_TO_DRAINER"><code>StoreIngestionTask.DelegateConsumerRecordResult.QUEUED_TO_DRAINER</code></a>.

 This function assumes <a href="#shouldProcessRecord(com.linkedin.venice.pubsub.api.DefaultPubSubMessage)"><code>shouldProcessRecord(DefaultPubSubMessage)</code></a> has been called which happens in
 <a href="StoreIngestionTask.html#produceToStoreBufferServiceOrKafka(java.lang.Iterable,com.linkedin.venice.pubsub.api.PubSubTopicPartition,java.lang.String,int)"><code>StoreIngestionTask.produceToStoreBufferServiceOrKafka(Iterable, PubSubTopicPartition, String, int)</code></a>
 before calling this and the it was decided that this record needs to be processed. It does not perform any
 validation check on the PartitionConsumptionState object to keep the goal of the function simple and not overload.

 Also DIV validation is done here if the message is received from RT topic. For more info please see
 please see StoreIngestionTask#internalProcessConsumerRecord(PubSubMessage, PartitionConsumptionState, LeaderProducedRecordContext, int, String, long)

 This function may modify the original record in KME and it is unsafe to use the payload from KME directly after this function.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#delegateConsumerRecord(com.linkedin.davinci.kafka.consumer.PubSubMessageProcessedResultWrapper,int,java.lang.String,int,long,long)">delegateConsumerRecord</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
<dt>Returns:</dt>
<dd>a <a href="StoreIngestionTask.DelegateConsumerRecordResult.html" title="enum class in com.linkedin.davinci.kafka.consumer"><code>StoreIngestionTask.DelegateConsumerRecordResult</code></a> indicating what to do with the record</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="waitForAllMessageToBeProcessedFromTopicPartition(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>waitForAllMessageToBeProcessedFromTopicPartition</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">waitForAllMessageToBeProcessedFromTopicPartition</span><wbr><span class="parameters">(<a href="../../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;topicPartition,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span>
                                                         throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></span></div>
<div class="block">Besides draining messages in the drainer queue, wait for the last producer future.</div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#waitForAllMessageToBeProcessedFromTopicPartition(com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">waitForAllMessageToBeProcessedFromTopicPartition</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
<dt>Parameters:</dt>
<dd><code>topicPartition</code> - for which to wait</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getLatestPersistedRtPositionForLagMeasurement(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String)">
<h3>getLatestPersistedRtPositionForLagMeasurement</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a></span>&nbsp;<span class="element-name">getLatestPersistedRtPositionForLagMeasurement</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;ignoredUpstreamKafkaUrl)</span></div>
<div class="block">For L/F or NR, there is only one entry in upstreamOffsetMap whose key is NON_AA_REPLICATION_UPSTREAM_OFFSET_MAP_KEY.
 Return the value of the entry.</div>
</section>
</li>
<li>
<section class="detail" id="getLatestConsumedUpstreamPositionForHybridOffsetLagMeasurement(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String)">
<h3>getLatestConsumedUpstreamPositionForHybridOffsetLagMeasurement</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a></span>&nbsp;<span class="element-name">getLatestConsumedUpstreamPositionForHybridOffsetLagMeasurement</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;ignoredKafkaUrl)</span></div>
<div class="block">For regular L/F stores without A/A enabled, there is always only one real-time source.</div>
</section>
</li>
<li>
<section class="detail" id="updateLatestConsumedRtPositions(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String,com.linkedin.venice.pubsub.api.PubSubPosition)">
<h3>updateLatestConsumedRtPositions</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">updateLatestConsumedRtPositions</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;ignoredPubSubBrokerAddress,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;pubSubPosition)</span></div>
</section>
</li>
<li>
<section class="detail" id="consumerUnSubscribeAllTopics(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>consumerUnSubscribeAllTopics</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">consumerUnSubscribeAllTopics</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<div class="block">Unsubscribe from all the topics being consumed for the partition in partitionConsumptionState</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#consumerUnSubscribeAllTopics(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">consumerUnSubscribeAllTopics</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getWriteComputeErrorCode()">
<h3>getWriteComputeErrorCode</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">getWriteComputeErrorCode</span>()</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#getWriteComputeErrorCode()">getWriteComputeErrorCode</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="updateLeaderTopicOnFollower(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>updateLeaderTopicOnFollower</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">updateLeaderTopicOnFollower</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#updateLeaderTopicOnFollower(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">updateLeaderTopicOnFollower</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="maybeCompressData(int,java.nio.ByteBuffer,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>maybeCompressData</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/ByteBuffer.html" title="class or interface in java.nio" class="external-link">ByteBuffer</a></span>&nbsp;<span class="element-name">maybeCompressData</span><wbr><span class="parameters">(int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/ByteBuffer.html" title="class or interface in java.nio" class="external-link">ByteBuffer</a>&nbsp;data,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<div class="block">Compresses data in a bytebuffer when consuming from rt as a leader node and compression is enabled for the store
 version for which we're consuming data.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>partition</code> - which partition we're acting on so as to determine the PartitionConsumptionState</dd>
<dd><code>data</code> - the data that we might compress</dd>
<dt>Returns:</dt>
<dd>a bytebuffer that's either the original bytebuffer or a new one depending on if we compressed it.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="shouldCompressData(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>shouldCompressData</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">shouldCompressData</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
</section>
</li>
<li>
<section class="detail" id="processMessageAndMaybeProduceToKafka(com.linkedin.davinci.kafka.consumer.PubSubMessageProcessedResultWrapper,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,int,java.lang.String,int,long,long)">
<h3>processMessageAndMaybeProduceToKafka</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">processMessageAndMaybeProduceToKafka</span><wbr><span class="parameters">(<a href="PubSubMessageProcessedResultWrapper.html" title="class in com.linkedin.davinci.kafka.consumer">PubSubMessageProcessedResultWrapper</a>&nbsp;consumerRecordWrapper,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 int&nbsp;kafkaClusterId,
 long&nbsp;beforeProcessingRecordTimestampNs,
 long&nbsp;beforeProcessingBatchRecordsTimestampMs)</span></div>
</section>
</li>
<li>
<section class="detail" id="getGlobalRtDivKeyName(java.lang.String)">
<h3>getGlobalRtDivKeyName</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">getGlobalRtDivKeyName</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;brokerUrl)</span></div>
<div class="block">The Global RT DIV is produced on a per-broker basis, so the name includes the broker URL for differentiation.</div>
</section>
</li>
<li>
<section class="detail" id="getGlobalRtDivKeyBytes(java.lang.String)">
<h3>getGlobalRtDivKeyBytes</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">byte[]</span>&nbsp;<span class="element-name">getGlobalRtDivKeyBytes</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;brokerUrl)</span></div>
</section>
</li>
<li>
<section class="detail" id="measureRtLagForSingleRegion(java.lang.String,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,boolean)">
<h3>measureRtLagForSingleRegion</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">measureRtLagForSingleRegion</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;rtPubSubBrokerAddress,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs,
 boolean&nbsp;shouldLog)</span></div>
<div class="block">This method fetches/calculates latest leader persisted position and last position in RT topic. The method relies on
 <a href="#getLatestPersistedRtPositionForLagMeasurement(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.lang.String)"><code>getLatestPersistedRtPositionForLagMeasurement(PartitionConsumptionState, String)</code></a> to fetch
 latest leader persisted position for different data replication policy.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the lag (endPositionInRealTimeTopic - latestPersistedLeaderPosition - 1)</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="processControlMessageForViews(com.linkedin.venice.message.KafkaKey,com.linkedin.venice.kafka.protocol.KafkaMessageEnvelope,com.linkedin.venice.kafka.protocol.ControlMessage,int,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>processControlMessageForViews</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">processControlMessageForViews</span><wbr><span class="parameters">(<a href="../../../venice/message/KafkaKey.html" title="class in com.linkedin.venice.message">KafkaKey</a>&nbsp;kafkaKey,
 <a href="../../../venice/kafka/protocol/KafkaMessageEnvelope.html" title="class in com.linkedin.venice.kafka.protocol">KafkaMessageEnvelope</a>&nbsp;kafkaMessageEnvelope,
 <a href="../../../venice/kafka/protocol/ControlMessage.html" title="class in com.linkedin.venice.kafka.protocol">ControlMessage</a>&nbsp;controlMessage,
 int&nbsp;partition,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from class:&nbsp;<code><a href="StoreIngestionTask.html#processControlMessageForViews(com.linkedin.venice.message.KafkaKey,com.linkedin.venice.kafka.protocol.KafkaMessageEnvelope,com.linkedin.venice.kafka.protocol.ControlMessage,int,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">StoreIngestionTask</a></code></span></div>
<div class="block">This isn't used for ingestion outside L/F, so we NoOp here and rely on the actual implementation in
  <a href="LeaderFollowerStoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer"><code>LeaderFollowerStoreIngestionTask</code></a></div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#processControlMessageForViews(com.linkedin.venice.message.KafkaKey,com.linkedin.venice.kafka.protocol.KafkaMessageEnvelope,com.linkedin.venice.kafka.protocol.ControlMessage,int,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">processControlMessageForViews</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="createProducerCallback(com.linkedin.venice.pubsub.api.DefaultPubSubMessage,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,com.linkedin.davinci.kafka.consumer.LeaderProducedRecordContext,int,java.lang.String,long)">
<h3>createProducerCallback</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="LeaderProducerCallback.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducerCallback</a></span>&nbsp;<span class="element-name">createProducerCallback</span><wbr><span class="parameters">(<a href="../../../venice/pubsub/api/DefaultPubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">DefaultPubSubMessage</a>&nbsp;consumerRecord,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="LeaderProducedRecordContext.html" title="class in com.linkedin.davinci.kafka.consumer">LeaderProducedRecordContext</a>&nbsp;leaderProducedRecordContext,
 int&nbsp;partition,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;kafkaUrl,
 long&nbsp;beforeProcessingRecordTimestampNs)</span></div>
</section>
</li>
<li>
<section class="detail" id="getVeniceWriter(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>getVeniceWriter</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;<a href="../../../venice/writer/VeniceWriter.html" title="class in com.linkedin.venice.writer">VeniceWriter</a>&lt;byte[],<wbr>byte[],<wbr>byte[]&gt;&gt;</span>&nbsp;<span class="element-name">getVeniceWriter</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span></div>
</section>
</li>
<li>
<section class="detail" id="addPartitionConsumptionState(java.lang.Integer,com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>addPartitionConsumptionState</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">addPartitionConsumptionState</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&nbsp;partition,
 <a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;pcs)</span></div>
</section>
</li>
<li>
<section class="detail" id="maybeSendIngestionHeartbeat()">
<h3>maybeSendIngestionHeartbeat</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;</span>&nbsp;<span class="element-name">maybeSendIngestionHeartbeat</span>()</div>
<div class="block">For hybrid stores only, the leader periodically writes a special SOS message to the RT topic with the following properties: <br>
 1. Special key: This key contains constant bytes, allowing for compaction. <br>
 2. Fixed/known producer GUID: This GUID is dedicated to heartbeats and prevents DIV from breaking. <br>
 3. Special segment: This segment never contains data, eliminating the need for an EOS message. <br>
 <p>
 Upon consuming the SOS message, the leader writes it to its local VT. Once the drainer processes the record, the leader updates
 its latest processed upstream RT topic offset. At this point, the offset reflects the correct position, regardless of trailing
 CMs or skippable data records due to DCR.
 <p>
 This heartbeat message does not send a leader completion header. This results in having the leader completion states only in VTs and not
 in the RT, avoiding the need to differentiate between heartbeats from leaders of different versions (backup/current/future) and colos.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#maybeSendIngestionHeartbeat()">maybeSendIngestionHeartbeat</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
<dt>Returns:</dt>
<dd>the set of partitions that failed to send heartbeat (used for tests)</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="resubscribe(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>resubscribe</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">resubscribe</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span>
                    throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></span></div>
<div class="block">Resubscribe operation by passing new version role and partition role to <a href="AggKafkaConsumerService.html" title="class in com.linkedin.davinci.kafka.consumer"><code>AggKafkaConsumerService</code></a>. The action
  for leader and follower replica will be handled differently.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="StoreIngestionTask.html#resubscribe(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">resubscribe</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="resubscribeAsFollower(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>resubscribeAsFollower</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">resubscribeAsFollower</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span>
                              throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></span></div>
<dl class="notes">
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="resubscribeAsLeader(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState)">
<h3>resubscribeAsLeader</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">resubscribeAsLeader</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState)</span>
                            throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></span></div>
<dl class="notes">
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="queueUpVersionTopicWritesWithViewWriters(com.linkedin.davinci.kafka.consumer.PartitionConsumptionState,java.util.function.BiFunction,java.util.Map,java.lang.Runnable)">
<h3>queueUpVersionTopicWritesWithViewWriters</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">queueUpVersionTopicWritesWithViewWriters</span><wbr><span class="parameters">(<a href="PartitionConsumptionState.html" title="class in com.linkedin.davinci.kafka.consumer">PartitionConsumptionState</a>&nbsp;partitionConsumptionState,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/BiFunction.html" title="class or interface in java.util.function" class="external-link">BiFunction</a>&lt;<a href="../../store/view/VeniceViewWriter.html" title="class in com.linkedin.davinci.store.view">VeniceViewWriter</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;,<wbr><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;&gt;&nbsp;viewWriterRecordProcessor,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;&gt;&nbsp;viewPartitionMap,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runnable.html" title="class or interface in java.lang" class="external-link">Runnable</a>&nbsp;versionTopicWrite)</span></div>
</section>
</li>
<li>
<section class="detail" id="hasViewWriters()">
<h3>hasViewWriters</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">hasViewWriters</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getDataRecoverySourcePubSub(com.linkedin.venice.meta.Version)">
<h3>getDataRecoverySourcePubSub</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">getDataRecoverySourcePubSub</span><wbr><span class="parameters">(<a href="../../../venice/meta/Version.html" title="interface in com.linkedin.venice.meta">Version</a>&nbsp;version)</span></div>
</section>
</li>
<li>
<section class="detail" id="refreshIngestionContextIfChanged(com.linkedin.venice.meta.Store)">
<h3>refreshIngestionContextIfChanged</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">refreshIngestionContextIfChanged</span><wbr><span class="parameters">(<a href="../../../venice/meta/Store.html" title="interface in com.linkedin.venice.meta">Store</a>&nbsp;store)</span>
                                         throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></span></div>
<dl class="notes">
<dt>Overrides:</dt>
<dd><code><a href="StoreIngestionTask.html#refreshIngestionContextIfChanged(com.linkedin.venice.meta.Store)">refreshIngestionContextIfChanged</a></code>&nbsp;in class&nbsp;<code><a href="StoreIngestionTask.html" title="class in com.linkedin.davinci.kafka.consumer">StoreIngestionTask</a></code></dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setNativeReplicationSourceVersionTopicKafkaURL(java.lang.String)">
<h3>setNativeReplicationSourceVersionTopicKafkaURL</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setNativeReplicationSourceVersionTopicKafkaURL</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;nativeReplicationSourceVersionTopicKafkaURL)</span></div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
