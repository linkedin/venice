<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>StatefulVeniceChangelogConsumer (venice API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.linkedin.davinci.consumer, interface: StatefulVeniceChangelogConsumer">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">com.linkedin.davinci.consumer</a></div>
<h1 title="Interface StatefulVeniceChangelogConsumer" class="title">Interface StatefulVeniceChangelogConsumer&lt;K,<wbr>V&gt;</h1>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>Type Parameters:</dt>
<dd><code>K</code> - Key type</dd>
<dd><code>V</code> - Value type</dd>
</dl>
<dl class="notes">
<dt>All Superinterfaces:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/AutoCloseable.html" title="class or interface in java.lang" class="external-link">AutoCloseable</a></code></dd>
</dl>
<dl class="notes">
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="VeniceChangelogConsumerDaVinciRecordTransformerImpl.html" title="class in com.linkedin.davinci.consumer">VeniceChangelogConsumerDaVinciRecordTransformerImpl</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public interface </span><span class="element-name type-name-label">StatefulVeniceChangelogConsumer&lt;K,<wbr>V&gt;</span><span class="extends-implements">
extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/AutoCloseable.html" title="class or interface in java.lang" class="external-link">AutoCloseable</a></span></div>
<div class="block">This interface is meant for users where local state must be built off of the entirety of a Venice data set.

 This interface provides automatic state management with local checkpointing and efficient data access
 through local compaction. It eliminates the need for manual checkpoint management and improves restart performance.

 KEY BENEFITS:
 - Automatic State Management: No need to manually manage checkpoints.
   The client handles all state management automatically.
 - Efficient Restart: Resumes from the last checkpoint on restart, consuming only new changes since the last
   Kafka checkpoint. This reduces recovery time and eliminates the need to re-consume every event from Kafka
   on restart.
 - Local Compaction: All data is compacted locally, providing efficient access to the current state without consuming
   duplicate events.
 - Fast Bootstrap on Fresh Nodes: On fresh nodes without local state, obtains a complete data snapshot from existing
   nodes instead of consuming evert Kafka event (requires blob transfer to be enabled).

 This interface intentionally does not expose seek() operations for simplicity.
 For more fine-grained control over seeking, see <a href="VeniceChangelogConsumer.html" title="interface in com.linkedin.davinci.consumer"><code>VeniceChangelogConsumer</code></a>.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab3" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab3', 3)" class="table-tab">Abstract Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Long.html" title="class or interface in java.lang" class="external-link">Long</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#getLastHeartbeatPerPartition()" class="member-name-link">getLastHeartbeatPerPartition</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Returns the timestamp of the last heartbeat received for each subscribed partition.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#isCaughtUp()" class="member-name-link">isCaughtUp</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Indicates whether all subscribed partitions have caught up to the latest offset at the time of subscription.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Collection.html" title="class or interface in java.util" class="external-link">Collection</a>&lt;<a href="../../venice/pubsub/api/PubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">PubSubMessage</a>&lt;<a href="StatefulVeniceChangelogConsumer.html" title="type parameter in StatefulVeniceChangelogConsumer">K</a>,<wbr><a href="ChangeEvent.html" title="class in com.linkedin.davinci.consumer">ChangeEvent</a>&lt;<a href="StatefulVeniceChangelogConsumer.html" title="type parameter in StatefulVeniceChangelogConsumer">V</a>&gt;,<wbr><a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#poll(long)" class="member-name-link">poll</a><wbr>(long&nbsp;timeoutInMs)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Polls for the next batch of change events.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#start()" class="member-name-link">start</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Subscribes to every partition for the Venice store.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#start(java.util.Set)" class="member-name-link">start</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;&nbsp;partitions)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Starts the consumer by subscribing to the specified partitions.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#stop()" class="member-name-link">stop</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">&nbsp;</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.AutoCloseable">Methods inherited from interface&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/AutoCloseable.html" title="class or interface in java.lang" class="external-link">AutoCloseable</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/AutoCloseable.html#close()" title="class or interface in java.lang" class="external-link">close</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="start(java.util.Set)">
<h3>start</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;</span>&nbsp;<span class="element-name">start</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;&nbsp;partitions)</span></div>
<div class="block">Starts the consumer by subscribing to the specified partitions. On restart, the client automatically resumes
 from the last checkpoint. On fresh start, it begins from the beginning of the topic or leverages blob transfer
 if available.

 The returned future completes when there is at least one message available to be polled.
 Use <a href="#isCaughtUp()"><code>isCaughtUp()</code></a> to determine when all subscribed partitions have caught up to the latest offset.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>partitions</code> - Set of partition IDs to subscribe to. Pass empty set to subscribe to all partitions.</dd>
<dt>Returns:</dt>
<dd>A future that completes when at least one message is available to poll.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="start()">
<h3>start</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;</span>&nbsp;<span class="element-name">start</span>()</div>
<div class="block">Subscribes to every partition for the Venice store. See <a href="#start(java.util.Set)"><code>start(Set)</code></a> for more information.</div>
</section>
</li>
<li>
<section class="detail" id="stop()">
<h3>stop</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">stop</span>()
   throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></span></div>
<dl class="notes">
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="poll(long)">
<h3>poll</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Collection.html" title="class or interface in java.util" class="external-link">Collection</a>&lt;<a href="../../venice/pubsub/api/PubSubMessage.html" title="interface in com.linkedin.venice.pubsub.api">PubSubMessage</a>&lt;<a href="StatefulVeniceChangelogConsumer.html" title="type parameter in StatefulVeniceChangelogConsumer">K</a>,<wbr><a href="ChangeEvent.html" title="class in com.linkedin.davinci.consumer">ChangeEvent</a>&lt;<a href="StatefulVeniceChangelogConsumer.html" title="type parameter in StatefulVeniceChangelogConsumer">V</a>&gt;,<wbr><a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;&gt;</span>&nbsp;<span class="element-name">poll</span><wbr><span class="parameters">(long&nbsp;timeoutInMs)</span></div>
<div class="block">Polls for the next batch of change events. The first records returned after calling <a href="#start(java.util.Set)"><code>start(Set)</code></a> will be from the
 local compacted state. Once the local state is fully consumed, subsequent calls will return
 real-time updates made to the Venice store.

 Records are returned in batches up to the configured MAX_BUFFER_SIZE. This method will return immediately if:
 1. The buffer reaches MAX_BUFFER_SIZE before the timeout expires, OR
 2. The timeout is reached

 NOTE: If the PubSubMessage came from disk (after restart), the following fields will be set to sentinel values
 since record metadata information is not persisted to reduce disk utilization:
  - PubSubMessageTime
  - Position</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>timeoutInMs</code> - Maximum timeout of the poll invocation in milliseconds</dd>
<dt>Returns:</dt>
<dd>A collection of Venice PubSubMessages containing change events</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isCaughtUp()">
<h3>isCaughtUp</h3>
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">isCaughtUp</span>()</div>
<div class="block">Indicates whether all subscribed partitions have caught up to the latest offset at the time of subscription.
 Once this becomes true, it will remain true even if the consumer begins to lag later on.

 This is for determining when the initial bootstrap phase has completed and the consumer has transitioned
 to consuming real-time events.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>True if all subscribed partitions have caught up to their target offsets.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getLastHeartbeatPerPartition()">
<h3>getLastHeartbeatPerPartition</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Long.html" title="class or interface in java.lang" class="external-link">Long</a>&gt;</span>&nbsp;<span class="element-name">getLastHeartbeatPerPartition</span>()</div>
<div class="block">Returns the timestamp of the last heartbeat received for each subscribed partition.
 Heartbeats are messages sent every minute by Venice servers to measure lag.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>a map of partition number to the timestamp, in milliseconds, of the last
         heartbeat received for that partition.</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
