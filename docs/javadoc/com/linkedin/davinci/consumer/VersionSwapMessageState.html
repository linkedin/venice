<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>VersionSwapMessageState (venice API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.linkedin.davinci.consumer, class: VersionSwapMessageState">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">com.linkedin.davinci.consumer</a></div>
<h1 title="Class VersionSwapMessageState" class="title">Class VersionSwapMessageState</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">com.linkedin.davinci.consumer.VersionSwapMessageState</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">VersionSwapMessageState</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">A class initialized to indicate that the changelog consumer is undergoing version swap. The class is also keeping
 various states about this version swap. This class is thread safe by having all methods that change or read a state
 that's mutable synchronized. However, it's important to keep in mind that race can still occur if the caller is
 trying to perform a sequence of events that depend on each other. In those scenarios an external lock is required.
 E.g. (1) getFindNewTopicCheckpointFuture() and if the future is complete call (2) getNewTopicVersionSwapCheckpoints()
 By the time (2) is called it's possible that the result from (1) is no longer valid. A different thread slipped in
 between and changed the state.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(com.linkedin.venice.kafka.protocol.VersionSwap,int,java.util.Set,long)" class="member-name-link">VersionSwapMessageState</a><wbr>(<a href="../../venice/kafka/protocol/VersionSwap.html" title="class in com.linkedin.venice.kafka.protocol">VersionSwap</a>&nbsp;versionSwap,
 int&nbsp;totalRegionCount,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&gt;&nbsp;currentAssignment,
 long&nbsp;versionSwapStartTimestamp)</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getAssignedPartitions()" class="member-name-link">getAssignedPartitions</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getFindNewTopicCheckpointFuture()" class="member-name-link">getFindNewTopicCheckpointFuture</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getIncompletePartitions()" class="member-name-link">getIncompletePartitions</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getNewTopicCheckpointsWithEOPAsBackup()" class="member-name-link">getNewTopicCheckpointsWithEOPAsBackup</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Intended to be used as a backup strategy if any partition still did not complete version swap within the timeout.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getNewTopicVersionSwapCheckpoints()" class="member-name-link">getNewTopicVersionSwapCheckpoints</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getNewVersionTopic()" class="member-name-link">getNewVersionTopic</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getOldVersionTopic()" class="member-name-link">getOldVersionTopic</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getVersionSwapGenerationId()" class="member-name-link">getVersionSwapGenerationId</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getVersionSwapLowWatermarkPosition(java.lang.String,int)" class="member-name-link">getVersionSwapLowWatermarkPosition</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;topic,
 int&nbsp;partitionId)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Get the pub sub position of the first relevant version swap message for the given partition.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>long</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getVersionSwapStartTimestamp()" class="member-name-link">getVersionSwapStartTimestamp</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">If we have reached the timeout for the version swap, we need to forcefully seek to the new topic using the EOP
 positions for any remaining partitions as our backup plan which should cover a variety of edge cases (e.g.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#handleUnsubscribe(java.util.Set)" class="member-name-link">handleUnsubscribe</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;&nbsp;partitions)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Remove unsubscribed partitions from the ongoing version swap states.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#handleVersionSwap(com.linkedin.venice.kafka.protocol.VersionSwap,com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.venice.pubsub.api.PubSubPosition)" class="member-name-link">handleVersionSwap</a><wbr>(<a href="../../venice/kafka/protocol/VersionSwap.html" title="class in com.linkedin.venice.kafka.protocol">VersionSwap</a>&nbsp;versionSwap,
 <a href="../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;pubSubTopicPartition,
 <a href="../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;position)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Handle the version swap message and check if all version swap messages related to this version swap event have
 been received for the given partition.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#isVersionSwapMessagesReceivedForAllPartitions()" class="member-name-link">isVersionSwapMessagesReceivedForAllPartitions</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isVersionSwapRelevant(java.lang.String,java.lang.String,com.linkedin.venice.kafka.protocol.VersionSwap)" class="member-name-link">isVersionSwapRelevant</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;currentVersionTopic,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;clientRegion,
 <a href="../../venice/kafka/protocol/VersionSwap.html" title="class in com.linkedin.venice.kafka.protocol">VersionSwap</a>&nbsp;versionSwap)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Determines if the version swap message is relevant or not based on the version topic that it was consumed from and
 the version swap message content.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setFindNewTopicCheckpointFuture(java.util.concurrent.CompletableFuture)" class="member-name-link">setFindNewTopicCheckpointFuture</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;&nbsp;findNewTopicCheckpointFuture)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setNewTopicEOPCheckpoints(java.util.Map)" class="member-name-link">setNewTopicEOPCheckpoints</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;&nbsp;newTopicEOPCheckpoints)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setNewTopicVersionSwapCheckpoints(java.util.Map)" class="member-name-link">setNewTopicVersionSwapCheckpoints</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;&nbsp;newTopicVersionSwapCheckpoints)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(com.linkedin.venice.kafka.protocol.VersionSwap,int,java.util.Set,long)">
<h3>VersionSwapMessageState</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">VersionSwapMessageState</span><wbr><span class="parameters">(<a href="../../venice/kafka/protocol/VersionSwap.html" title="class in com.linkedin.venice.kafka.protocol">VersionSwap</a>&nbsp;versionSwap,
 int&nbsp;totalRegionCount,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&gt;&nbsp;currentAssignment,
 long&nbsp;versionSwapStartTimestamp)</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="getVersionSwapLowWatermarkPosition(java.lang.String,int)">
<h3>getVersionSwapLowWatermarkPosition</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a></span>&nbsp;<span class="element-name">getVersionSwapLowWatermarkPosition</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;topic,
 int&nbsp;partitionId)</span></div>
<div class="block">Get the pub sub position of the first relevant version swap message for the given partition. Null will be returned
 if the partition have not consumed its version swap yet. This is acceptable because different partitions could be
 making progress towards version swap at different pace. e.g. partition 0 consumed its version swap message already
 but partition 1 could still be consuming regular messages from the old version topic before encountering any
 version swap messages.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>topic</code> - where the version swap message originated from</dd>
<dd><code>partitionId</code> - of the version topic</dd>
<dt>Returns:</dt>
<dd>the pub sub position or null</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getOldVersionTopic()">
<h3>getOldVersionTopic</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">getOldVersionTopic</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getNewVersionTopic()">
<h3>getNewVersionTopic</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">getNewVersionTopic</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getVersionSwapGenerationId()">
<h3>getVersionSwapGenerationId</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getVersionSwapGenerationId</span>()</div>
</section>
</li>
<li>
<section class="detail" id="setFindNewTopicCheckpointFuture(java.util.concurrent.CompletableFuture)">
<h3>setFindNewTopicCheckpointFuture</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setFindNewTopicCheckpointFuture</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;&nbsp;findNewTopicCheckpointFuture)</span></div>
</section>
</li>
<li>
<section class="detail" id="getFindNewTopicCheckpointFuture()">
<h3>getFindNewTopicCheckpointFuture</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/CompletableFuture.html" title="class or interface in java.util.concurrent" class="external-link">CompletableFuture</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Void.html" title="class or interface in java.lang" class="external-link">Void</a>&gt;</span>&nbsp;<span class="element-name">getFindNewTopicCheckpointFuture</span>()</div>
</section>
</li>
<li>
<section class="detail" id="setNewTopicVersionSwapCheckpoints(java.util.Map)">
<h3>setNewTopicVersionSwapCheckpoints</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setNewTopicVersionSwapCheckpoints</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;&nbsp;newTopicVersionSwapCheckpoints)</span></div>
</section>
</li>
<li>
<section class="detail" id="setNewTopicEOPCheckpoints(java.util.Map)">
<h3>setNewTopicEOPCheckpoints</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setNewTopicEOPCheckpoints</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>,<wbr><a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;&nbsp;newTopicEOPCheckpoints)</span></div>
</section>
</li>
<li>
<section class="detail" id="getNewTopicVersionSwapCheckpoints()">
<h3>getNewTopicVersionSwapCheckpoints</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;</span>&nbsp;<span class="element-name">getNewTopicVersionSwapCheckpoints</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getNewTopicCheckpointsWithEOPAsBackup()">
<h3>getNewTopicCheckpointsWithEOPAsBackup</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="VeniceChangeCoordinate.html" title="class in com.linkedin.davinci.consumer">VeniceChangeCoordinate</a>&gt;</span>&nbsp;<span class="element-name">getNewTopicCheckpointsWithEOPAsBackup</span>()</div>
<div class="block">Intended to be used as a backup strategy if any partition still did not complete version swap within the timeout.
 Remaining partitions will be resumed from EOP instead of first relevant version swap message in the new topic.</div>
</section>
</li>
<li>
<section class="detail" id="getAssignedPartitions()">
<h3>getAssignedPartitions</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;</span>&nbsp;<span class="element-name">getAssignedPartitions</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getIncompletePartitions()">
<h3>getIncompletePartitions</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;</span>&nbsp;<span class="element-name">getIncompletePartitions</span>()</div>
</section>
</li>
<li>
<section class="detail" id="getVersionSwapStartTimestamp()">
<h3>getVersionSwapStartTimestamp</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">long</span>&nbsp;<span class="element-name">getVersionSwapStartTimestamp</span>()</div>
<div class="block">If we have reached the timeout for the version swap, we need to forcefully seek to the new topic using the EOP
 positions for any remaining partitions as our backup plan which should cover a variety of edge cases (e.g. consumer
 is not polling fast enough, consumer starting position was in between version swaps, a region is down, etc...) In
 all these edge cases it's better to go to the new topic and consume a lot of duplicate messages than staying on the
 old topic which will eventually be deleted.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the timestamp when the version swap was started.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isVersionSwapMessagesReceivedForAllPartitions()">
<h3>isVersionSwapMessagesReceivedForAllPartitions</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">isVersionSwapMessagesReceivedForAllPartitions</span>()</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>true if all partitions have received all the version swap messages required for this version swap event.
 This means we can subscribe to the new version topic and resume normal consumption from the first relevant version
 swap message.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="handleVersionSwap(com.linkedin.venice.kafka.protocol.VersionSwap,com.linkedin.venice.pubsub.api.PubSubTopicPartition,com.linkedin.venice.pubsub.api.PubSubPosition)">
<h3>handleVersionSwap</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">handleVersionSwap</span><wbr><span class="parameters">(<a href="../../venice/kafka/protocol/VersionSwap.html" title="class in com.linkedin.venice.kafka.protocol">VersionSwap</a>&nbsp;versionSwap,
 <a href="../../venice/pubsub/api/PubSubTopicPartition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubTopicPartition</a>&nbsp;pubSubTopicPartition,
 <a href="../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;position)</span></div>
<div class="block">Handle the version swap message and check if all version swap messages related to this version swap event have
 been received for the given partition.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>versionSwap</code> - message that we just received.</dd>
<dd><code>pubSubTopicPartition</code> - where we received the version swap message.</dd>
<dd><code>position</code> - of the version swap message.</dd>
<dt>Returns:</dt>
<dd>true if all version swap messages related to this version swap event have been received.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="handleUnsubscribe(java.util.Set)">
<h3>handleUnsubscribe</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">handleUnsubscribe</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&gt;&nbsp;partitions)</span></div>
<div class="block">Remove unsubscribed partitions from the ongoing version swap states.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>partitions</code> - to unsubscribe</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isVersionSwapRelevant(java.lang.String,java.lang.String,com.linkedin.venice.kafka.protocol.VersionSwap)">
<h3>isVersionSwapRelevant</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">isVersionSwapRelevant</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;currentVersionTopic,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;clientRegion,
 <a href="../../venice/kafka/protocol/VersionSwap.html" title="class in com.linkedin.venice.kafka.protocol">VersionSwap</a>&nbsp;versionSwap)</span></div>
<div class="block">Determines if the version swap message is relevant or not based on the version topic that it was consumed from and
 the version swap message content.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>currentVersionTopic</code> - where the version swap message was consumed from.</dd>
<dd><code>clientRegion</code> - of the consumer.</dd>
<dd><code>versionSwap</code> - message that was consumed.</dd>
<dt>Returns:</dt>
<dd>if the version swap message is relevant and should be processed.</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
