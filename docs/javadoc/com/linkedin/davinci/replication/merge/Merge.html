<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>Merge (venice API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.linkedin.davinci.replication.merge, interface: Merge">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">com.linkedin.davinci.replication.merge</a></div>
<h1 title="Interface Merge" class="title">Interface Merge&lt;T&gt;</h1>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="MergeByteBuffer.html" title="class in com.linkedin.davinci.replication.merge">MergeByteBuffer</a></code>, <code><a href="MergeGenericRecord.html" title="class in com.linkedin.davinci.replication.merge">MergeGenericRecord</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public interface </span><span class="element-name type-name-label">Merge&lt;T&gt;</span></div>
<div class="block">API for merging existing data with incoming writes.

 There should be at least one implementation of this interface for each version of the replication metadata protocol, and
 possibly more if multiple competing implementations are created in an attempt to optimize performance,
 efficiency or other considerations.

 Conceptually, the various functions merge together 4 elements relating to a given key in the store:

 1. The old value associated with the key
 2. The old replication metadata associated with the old value
 3. The incoming write operation for that key (absent in case of deletes)
 4. The timestamp of the write operation

 Conflict resolution rules must be applied deterministically such that given an old value and an old replication metadata, a
 set of write operations (and their associated timestamp) may be applied in any order and always converge to
 the same end result (i.e. to the same final value and replication metadata). This determinism is achieved by the following
 rules:

 1. The fields which are set in the write operation will clobber those of the old value if and only if the write
    operation timestamp is greater than the timestamp associated with that field in the replication metadata.
 2. Each element included in a collection merging operation is applied to the corresponding collection in
    the old value iif the write operation timestamp is greater than the timestamp of the corresponding
    element, than the timestamp of the corresponding element's tombstone, and than the collection's timestamp.
 3. In case of equal timestamps, the value of the field or of the element is compared to that of the old field
    or element in order to deterministically decide which one wins the conflict resolution.

 Note: all implementation must return the reference of the same <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> instance that was
 passed in. The input <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> object may be mutated or replaced its inner variables. As such,
 a caller of this function should not expect the passed in parameter to remain unchanged.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab3" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab3', 3)" class="table-tab">Abstract Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#delete(com.linkedin.davinci.schema.merge.ValueAndRmd,long,int,com.linkedin.venice.pubsub.api.PubSubPosition,int)" class="member-name-link">delete</a><wbr>(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
 long&nbsp;deleteOperationTimestamp,
 int&nbsp;deleteOperationColoID,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;newValueSourcePosition,
 int&nbsp;newValueSourceBrokerID)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#put(com.linkedin.davinci.schema.merge.ValueAndRmd,T,long,int,com.linkedin.venice.pubsub.api.PubSubPosition,int)" class="member-name-link">put</a><wbr>(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
 <a href="Merge.html" title="type parameter in Merge">T</a>&nbsp;newValue,
 long&nbsp;putOperationTimestamp,
 int&nbsp;putOperationColoID,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;newValueSourcePosition,
 int&nbsp;newValueSourceBrokerID)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#update(com.linkedin.davinci.schema.merge.ValueAndRmd,com.linkedin.venice.utils.lazy.Lazy,org.apache.avro.Schema,long,int,com.linkedin.venice.pubsub.api.PubSubPosition,int)" class="member-name-link">update</a><wbr>(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
 <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;org.apache.avro.generic.GenericRecord&gt;&nbsp;writeOperation,
 org.apache.avro.Schema&nbsp;currValueSchema,
 long&nbsp;updateOperationTimestamp,
 int&nbsp;updateOperationColoID,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;newValueSourcePosition,
 int&nbsp;newValueSourceBrokerID)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">&nbsp;</div>
</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="put(com.linkedin.davinci.schema.merge.ValueAndRmd,T,long,int,com.linkedin.venice.pubsub.api.PubSubPosition,int)">
<h3 id="put(com.linkedin.davinci.schema.merge.ValueAndRmd,java.lang.Object,long,int,com.linkedin.venice.pubsub.api.PubSubPosition,int)">put</h3>
<div class="member-signature"><span class="return-type"><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</span>&nbsp;<span class="element-name">put</span><wbr><span class="parameters">(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
 <a href="Merge.html" title="type parameter in Merge">T</a>&nbsp;newValue,
 long&nbsp;putOperationTimestamp,
 int&nbsp;putOperationColoID,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;newValueSourcePosition,
 int&nbsp;newValueSourceBrokerID)</span></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>oldValueAndRmd</code> - the old value and replication metadata which are persisted in the server prior
                                       to the write operation. Note that some implementation(s) may require the old
                                       value to be non-null. Please refer to the Javadoc of specific implementation.</dd>
<dd><code>newValue</code> - a record with all fields populated and with one of the registered value schemas</dd>
<dd><code>putOperationTimestamp</code> - the timestamp of the incoming write operation</dd>
<dd><code>putOperationColoID</code> - ID of the colo/fabric where this PUT request was originally received.</dd>
<dd><code>newValueSourcePosition</code> - The position from which the new value originates in the realtime stream.  Used to build
                               the ReplicationMetadata for the newly inserted record.</dd>
<dd><code>newValueSourceBrokerID</code> - The ID of the broker from which the new value originates.  ID's should correspond
                                 to the kafkaClusterUrlIdMap configured in the LeaderFollowerIngestionTask.  Used to build
                                 the ReplicationMetadata for the newly inserted record.</dd>
<dt>Returns:</dt>
<dd>the resulting <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> after merging the old one with the incoming write operation.
         The returned object is guaranteed to be "==" to the input oldValueAndReplicationMetadata object and the internal
         members of the object are possibly mutated.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="delete(com.linkedin.davinci.schema.merge.ValueAndRmd,long,int,com.linkedin.venice.pubsub.api.PubSubPosition,int)">
<h3>delete</h3>
<div class="member-signature"><span class="return-type"><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</span>&nbsp;<span class="element-name">delete</span><wbr><span class="parameters">(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
 long&nbsp;deleteOperationTimestamp,
 int&nbsp;deleteOperationColoID,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;newValueSourcePosition,
 int&nbsp;newValueSourceBrokerID)</span></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>oldValueAndRmd</code> - the old value and replication metadata which are persisted in the server prior to the write operation</dd>
<dd><code>newValueSourcePosition</code> - The position from which the new value originates in the realtime stream.  Used to build
                               the ReplicationMetadata for the newly inserted record.</dd>
<dd><code>deleteOperationColoID</code> - ID of the colo/fabric where this DELETE request was originally received.</dd>
<dd><code>newValueSourceBrokerID</code> - The ID of the broker from which the new value originates.  ID's should correspond
                                 to the kafkaClusterUrlIdMap configured in the LeaderFollowerIngestionTask.  Used to build
                                 the ReplicationMetadata for the newly inserted record.</dd>
<dt>Returns:</dt>
<dd>the resulting <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> after merging the old one with the incoming delete operation.
         The returned object is guaranteed to be "==" to the input oldValueAndReplicationMetadata object and the internal
         members of the object are possibly mutated.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="update(com.linkedin.davinci.schema.merge.ValueAndRmd,com.linkedin.venice.utils.lazy.Lazy,org.apache.avro.Schema,long,int,com.linkedin.venice.pubsub.api.PubSubPosition,int)">
<h3>update</h3>
<div class="member-signature"><span class="return-type"><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</span>&nbsp;<span class="element-name">update</span><wbr><span class="parameters">(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
 <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;org.apache.avro.generic.GenericRecord&gt;&nbsp;writeOperation,
 org.apache.avro.Schema&nbsp;currValueSchema,
 long&nbsp;updateOperationTimestamp,
 int&nbsp;updateOperationColoID,
 <a href="../../../venice/pubsub/api/PubSubPosition.html" title="interface in com.linkedin.venice.pubsub.api">PubSubPosition</a>&nbsp;newValueSourcePosition,
 int&nbsp;newValueSourceBrokerID)</span></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>oldValueAndRmd</code> - the old value and replication metadata which are persisted in the server prior to the write operation</dd>
<dd><code>writeOperation</code> - a record with a write compute schema</dd>
<dd><code>currValueSchema</code> - Schema of the current value that is to-be-updated here.</dd>
<dd><code>updateOperationTimestamp</code> - the timestamp of the incoming write operation</dd>
<dd><code>updateOperationColoID</code> - ID of the colo/fabric where this UPDATE request was originally received.</dd>
<dd><code>newValueSourcePosition</code> - The position from which the new value originates in the realtime stream.  Used to build
                               the ReplicationMetadata for the newly inserted record.</dd>
<dd><code>newValueSourceBrokerID</code> - The ID of the broker from which the new value originates.  ID's should correspond
                                 to the kafkaClusterUrlIdMap configured in the LeaderFollowerIngestionTask.  Used to build
                                 the ReplicationMetadata for the newly inserted record.</dd>
<dt>Returns:</dt>
<dd>the resulting <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> after merging the old one with the incoming write operation.
         The returned object is guaranteed to be "==" to the input oldValueAndReplicationMetadata object and the internal
         members of the object are possibly mutated.</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
